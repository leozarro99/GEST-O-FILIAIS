<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placa App</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Slightly darker background for a professional feel */
        }
        /* Custom styles for select arrow */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: none; /* Remove default arrow */
        }
        select::-ms-expand {
            display: none; /* Hide arrow in IE/Edge */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Keyframe animations for modals and toasts */
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scale-in {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        .animate-scale-in {
            animation: scale-in 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script type="text/javascript">
        console.log("Script principal come√ßando a carregar.");
        // Manual SVG Icons from Lucide React
        const icons = {
            FileText: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15 2z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>',
            PlusCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>',
            Search: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',
            Building: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M12 18h.01"/></svg>',
            Truck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-truck"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M19 18h2a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-1V6a2 2 0 0 0-2-2h-3a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/></svg>',
            UserCheck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="22 7 18 11 16 9"/></svg>',
            LogOut: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 16 22 12 17 8"/><line x1="22" x2="11" y1="12" y2="12"/></svg>',
            Trash2: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>',
            Menu: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>',
            X: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',
            ChevronDown: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>',
            ChevronUp: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-up"><path d="m18 15-6-6-6 6"/></svg>',
            LayoutDashboard: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>',
            CalendarDays: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>',
            User: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
            Users: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            Settings: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.28a2 2 0 0 0 .73 2.73l.04.02a2 2 0 0 1 .97 1.95v.44a2 2 0 0 1-.97 1.95l-.04.02a2 2 0 0 0-.73 2.73l.78 1.28a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.28a2 2 0 0 0-.73-2.73l-.04-.02a2 2 0 0 1-.97-1.95v-.44a2 2 0 0 1 .97-1.95l.04-.02a2 2 0 0 0 .73-2.73l-.78-1.28a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>',
            ArrowLeftRight: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-arrow-left-right"><path d="M8 3L4 7L8 11"/><path d="M4 7h16"/><path d="M16 21l4-4l-4-4"/><path d="M20 17H4"/></svg>',
            ArrowLeft: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>',
            MapPin: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M12 18.3a3.3 3.3 0 1 0 0-6.6 3.3 3.3 0 0 0 0 6.6z"/><path d="M12 2C7.58 2 4 5.58 4 10c0 5.57 8 12 8 12s8-6.43 8-12c0-4.42-3.58-8-8-8z"/></svg>',
            Factory: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-factory"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 9.86 2H7.14a2 2 0 0 0-1.66.9l-.82 1.2A2 2 0 0 1 4 6H2v14z"/><path d="M10 10v4"/><path d="M14 10v4"/><path d="M18 10v4"/><path d="M6 10v4"/></svg>',
            Edit: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>'
        };

        // Helper function to render Lucide icons
        function LucideIcon({ name, className }) {
            return React.createElement('span', {
                className: className,
                dangerouslySetInnerHTML: { __html: icons[name] || '' }
            });
        }

        // Componente de Mensagem/Toast
        function Toast({ message, type, onClose }) {
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? '‚úî' : '‚úñ'; // Simple icons for now

            React.useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000); // Auto-close after 3 seconds
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                React.createElement('div', { className: `fixed bottom-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg flex items-center space-x-2 z-50 transition-all duration-300 ease-in-out transform translate-y-0 opacity-100` },
                    React.createElement('span', { className: "font-bold text-xl" }, icon),
                    React.createElement('p', null, message),
                    React.createElement('button', { onClick: onClose, className: "ml-4 font-bold opacity-75 hover:opacity-100 transition-opacity" }, 'X')
                )
            );
        }

        // Componente de Confirma√ß√£o Modal
        function ConfirmationModal({ message, onConfirm, onCancel }) {
            return (
                React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 animate-fade-in" },
                    React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center transform scale-95 animate-scale-in" },
                        React.createElement('p', { className: "text-lg font-semibold text-gray-800 mb-6" }, message),
                        React.createElement('div', { className: "flex justify-center space-x-4" },
                            React.createElement('button', {
                                onClick: onConfirm,
                                className: "px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Confirmar"),
                            React.createElement('button', {
                                onClick: onCancel,
                                className: "px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition duration-150 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Cancelar")
                        )
                    )
                )
            );
        }


        // Wrap the entire React app rendering logic within window.onload
        window.onload = function() {
            console.log("window.onload disparado.");

            // Supabase client initialization
            const SUPABASE_URL = 'https://gfivmnnysomfwrffybeh.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmaXZtbm55c29tZndyZmZ5YmVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyOTY3NjgsImV4cCI6MjA2ODg3Mjc2OH0.NxetXJoCLh4q9zAqn_olimziI3YP4MAJzB8ed4qf8cg';

            let supabase;

            // Function to initialize Supabase and render the App
            const initializeSupabaseAndRenderApp = () => {
                try {
                    console.log("Tentando inicializar o cliente Supabase...");
                    // Corrected: Use 'supabase' (lowercase) as the global object
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log("Cliente Supabase inicializado com sucesso.");
                    ReactDOM.render(React.createElement(App, null), document.getElementById('root'));
                } catch (e) {
                    console.error("Erro ao inicializar o cliente Supabase:", e);
                    ReactDOM.render(
                        React.createElement('div', { style: { textAlign: 'center', padding: '20px', color: 'red' } },
                            React.createElement('h1', null, 'Erro ao Inicializar Supabase'),
                            React.createElement('p', null, `Ocorreu um erro ao inicializar o cliente Supabase: ${e.message}. Verifique as suas credenciais e a configura√ß√£o do projeto Supabase.`)
                        ),
                        document.getElementById('root')
                    );
                }
            };

            // Dynamically load Supabase library
            const supabaseScript = document.createElement('script');
            supabaseScript.src = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.0/dist/umd/supabase.min.js";
            supabaseScript.onload = () => {
                console.log("Biblioteca Supabase carregada com sucesso.");
                initializeSupabaseAndRenderApp();
            };
            supabaseScript.onerror = (error) => {
                console.error("Erro ao carregar a biblioteca Supabase:", error);
                ReactDOM.render(
                    React.createElement('div', { style: { textAlign: 'center', padding: '20px', color: 'red' } },
                        React.createElement('h1', null, 'Erro ao Carregar Aplica√ß√£o'),
                        React.createElement('p', null, 'A biblioteca Supabase n√£o foi carregada. Por favor, verifique a sua liga√ß√£o √† internet ou o link CDN do Supabase no c√≥digo HTML.')
                    ),
                    document.getElementById('root')
                );
            };
            document.head.appendChild(supabaseScript);


            // Global variable for app ID (from Canvas environment, if applicable, otherwise default)
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            // Componente para a tela de Login
            function LoginPage({ onLogin }) {
              const [username, setUsername] = React.useState('');
              const [password, setPassword] = React.useState('');
              const [error, setError] = React.useState('');
              const [isLoggingIn, setIsLoggingIn] = React.useState(false);

              const handleLogin = async (e) => {
                e.preventDefault();
                setIsLoggingIn(true);
                setError('');

                if (!username || !password) {
                  setError('Por favor, insira seu usu√°rio e senha.');
                  setIsLoggingIn(false);
                  return;
                }

                await new Promise(resolve => setTimeout(resolve, 1000));

                let role = null;

                // Special login for 'admin' user with fixed password
                if (username.toLowerCase() === 'admin' && password === '1234') {
                  role = 'administrador';
                } else {
                  try {
                    // Query the public app_users table for authentication for other users
                    const { data, error: fetchError } = await supabase
                      .from('app_users') // Supabase table name
                      .select('*')
                      .eq('username', username.toLowerCase())
                      .eq('password', password); // IMPORTANT: In production, hash passwords!

                    if (fetchError) throw fetchError;

                    if (data && data.length > 0) {
                      role = data[0].role;
                    }
                  } catch (e) {
                    console.error("Erro ao buscar usu√°rio no Supabase:", e);
                    setError("Erro ao autenticar. Por favor, tente novamente.");
                  }
                }

                if (role) {
                  onLogin(role, username); // Pass username as userId for data partitioning
                } else {
                  setError('Usu√°rio ou senha inv√°lidos.');
                }
                setIsLoggingIn(false);
              };

              return (
                React.createElement('div', { className: "flex items-center justify-center min-h-screen bg-gray-100 font-sans" },
                  React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-lg w-full max-w-md" },
                    // TERC SISTEMAS title
                    React.createElement('div', { className: "flex flex-col items-center justify-center mb-6" },
                        React.createElement('h2', { className: "text-4xl font-extrabold text-blue-600 text-center" }, "TERC SISTEMAS")
                        // Description removed from here
                    ),
                    error && (
                      React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                        React.createElement('strong', { className: "font-bold" }, "Erro:"),
                        React.createElement('span', { className: "block sm:inline" }, " ", error)
                      )
                    ),
                    React.createElement('form', { onSubmit: handleLogin },
                      React.createElement('div', { className: "mb-4" },
                        React.createElement('label', { htmlFor: "username", className: "block text-sm font-medium text-gray-700 mb-1" }, "Usu√°rio"),
                        React.createElement('input', {
                          type: "text",
                          id: "username",
                          value: username,
                          onChange: (e) => { setUsername(e.target.value); setError(''); },
                          className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                          placeholder: "Digite seu usu√°rio",
                          required: true,
                          disabled: isLoggingIn
                        })
                      ),
                      React.createElement('div', { className: "mb-6" },
                        React.createElement('label', { htmlFor: "password", className: "block text-sm font-medium text-gray-700 mb-1" }, "Senha"),
                        React.createElement('input', {
                          type: "password",
                          id: "password",
                          value: password,
                          onChange: (e) => setPassword(e.target.value),
                          className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                          placeholder: "Digite sua senha",
                          required: true,
                          disabled: isLoggingIn
                        })
                      ),
                      React.createElement('button', {
                        type: "submit",
                        className: "w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                        disabled: isLoggingIn
                      },
                        isLoggingIn ? (
                          React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                          )
                        ) : (
                          React.createElement(LucideIcon, { name: "UserCheck", className: "mr-2 h-5 w-5" })
                        ),
                        isLoggingIn ? 'Entrando...' : 'Entrar'
                      )
                    )
                  )
                )
              );
            }

            // Componente para Gerenciamento de Filiais
            function BranchManagement({ userId, showToast }) {
              const [newBranchName, setNewBranchName] = React.useState('');
              const [branches, setBranches] = React.useState([]);
              const [error, setError] = React.useState(null);
              const [isLoading, setIsLoading] = React.useState(false);
              const [showConfirmModal, setShowConfirmModal] = React.useState(false);
              const [branchToDelete, setBranchToDelete] = React.useState(null);
              const [editingBranch, setEditingBranch] = React.useState(null); // State to hold the branch being edited

              React.useEffect(() => {
                if (!userId) return;
                const fetchBranches = async () => {
                  setIsLoading(true);
                  const { data, error: fetchError } = await supabase
                    .from('filiais')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });

                  if (fetchError) {
                    console.error("Erro ao buscar filiais no Supabase:", fetchError);
                    setError("Erro ao carregar filiais. Por favor, recarregue a p√°gina.");
                    showToast("Erro ao carregar filiais.", "error");
                  } else {
                    setBranches(data);
                    setError(null);
                  }
                  setIsLoading(false);
                };
                fetchBranches();
              }, [userId, showToast]);

              const handleAddOrUpdateBranch = async (e) => {
                e.preventDefault();
                if (!newBranchName.trim()) {
                  setError("O nome da filial n√£o pode estar vazio.");
                  showToast("O nome da filial n√£o pode estar vazio.", "error");
                  return;
                }
                setIsLoading(true);
                try {
                  if (editingBranch) {
                    // Update existing branch
                    const { error: updateError } = await supabase
                      .from('filiais')
                      .update({ name: newBranchName.trim() })
                      .eq('id', editingBranch.id);

                    if (updateError) throw updateError;
                    showToast("Filial atualizada com sucesso!", "success");
                    setEditingBranch(null); // Exit edit mode
                  } else {
                    // Add new branch
                    const { error: insertError } = await supabase
                      .from('filiais')
                      .insert([
                        { name: newBranchName.trim(), created_by_username: userId }
                      ]);

                    if (insertError) throw insertError;
                    showToast("Filial adicionada com sucesso!", "success");
                  }

                  setNewBranchName('');
                  setError(null);
                  // Re-fetch data to update the list
                  const { data, error: fetchError } = await supabase
                    .from('filiais')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar filiais:", fetchError);
                  else setBranches(data);

                } catch (e) {
                  console.error("Erro ao salvar filial:", e);
                  setError(`Erro ao ${editingBranch ? 'atualizar' : 'adicionar'} filial. Tente novamente.`);
                  showToast(`Erro ao ${editingBranch ? 'atualizar' : 'adicionar'} filial.`, "error");
                }
                setIsLoading(false);
              };

              const handleEditBranch = (branch) => {
                setEditingBranch(branch);
                setNewBranchName(branch.name);
                setError(null); // Clear any previous errors
              };

              const handleCancelEdit = () => {
                setEditingBranch(null);
                setNewBranchName('');
                setError(null);
              };

              const confirmDeleteBranch = (branch) => {
                setBranchToDelete(branch);
                setShowConfirmModal(true);
              };

              const handleDeleteBranch = async () => {
                if (!branchToDelete) return;

                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                  const { error: deleteError } = await supabase
                    .from('filiais')
                    .delete()
                    .eq('id', branchToDelete.id);

                  if (deleteError) throw deleteError;

                  showToast("Filial exclu√≠da com sucesso!", "success");
                  // Re-fetch data to update the list
                  const { data, error: fetchError } = await supabase
                    .from('filiais')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar filiais:", fetchError);
                  else setBranches(data);

                } catch (e) {
                  console.error("Erro ao deletar filial:", e);
                  setError("Erro ao deletar filial. Tente novamente.");
                  showToast("Erro ao excluir filial.", "error");
                } finally {
                    setIsLoading(false);
                    setBranchToDelete(null);
                }
              };

              return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                  React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Filiais"),
                  error && (
                    React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                      React.createElement('strong', { className: "font-bold" }, "Erro:"),
                      React.createElement('span', { className: "block sm:inline" }, " ", error)
                    )
                  ),
                  React.createElement('form', { onSubmit: handleAddOrUpdateBranch, className: "flex flex-col sm:flex-row gap-4 mb-6" },
                    React.createElement('input', {
                      type: "text",
                      value: newBranchName,
                      onChange: (e) => setNewBranchName(e.target.value),
                      className: "flex-grow mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                      placeholder: "Nome da nova filial",
                      required: true,
                      disabled: isLoading
                    }),
                    React.createElement('button', {
                      type: "submit",
                      className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                      disabled: isLoading
                    },
                      isLoading ? (
                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                          React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                          React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                        )
                      ) : (
                        React.createElement(LucideIcon, { name: editingBranch ? "Edit" : "PlusCircle", className: "mr-2 h-5 w-5" })
                      ),
                      isLoading ? (editingBranch ? 'Atualizando...' : 'Adicionando...') : (editingBranch ? 'Atualizar Filial' : 'Adicionar Filial')
                    ),
                    editingBranch && React.createElement('button', {
                        type: "button",
                        onClick: handleCancelEdit,
                        className: "inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                        disabled: isLoading
                    }, "Cancelar")
                  ),
                  React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                    React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                      React.createElement('thead', { className: "bg-gray-100" },
                        React.createElement('tr', null,
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filial"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                        )
                      ),
                      React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                        isLoading && branches.length === 0 ? (
                            React.createElement('tr', null,
                                React.createElement('td', { colSpan: "2", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando filiais...")
                            )
                        ) : branches.length === 0 ? (
                          React.createElement('tr', null,
                            React.createElement('td', { colSpan: "2", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhuma filial cadastrada.")
                          )
                        ) : (
                          branches.map((branch) => (
                            React.createElement('tr', { key: branch.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, branch.name),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                React.createElement('button', {
                                  onClick: () => handleEditBranch(branch),
                                  className: "text-blue-600 hover:text-blue-800 mr-4 transition-colors duration-150",
                                  title: "Editar Filial",
                                  disabled: isLoading
                                },
                                  React.createElement(LucideIcon, { name: "Edit", className: "h-5 w-5" })
                                ),
                                React.createElement('button', {
                                  onClick: () => confirmDeleteBranch(branch),
                                  className: "text-red-600 hover:text-red-800 transition-colors duration-150",
                                  title: "Excluir Filial",
                                  disabled: isLoading
                                },
                                  React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                )
                              )
                            )
                          ))
                        )
                      )
                    )
                  ),
                  showConfirmModal && React.createElement(ConfirmationModal, {
                      message: `Tem certeza que deseja excluir a filial "${branchToDelete?.name}"?`,
                      onConfirm: handleDeleteBranch,
                      onCancel: () => setShowConfirmModal(false)
                  })
                )
              );
            }

            // Componente para Gerenciamento de Equipamentos
            function EquipmentManagement({ userId, showToast }) {
              const [newPlate, setNewPlate] = React.useState('');
              const [newEquipmentType, setNewEquipmentType] = React.useState('');
              const [equipmentList, setEquipmentList] = React.useState([]);
              const [error, setError] = React.useState(null);
              const [isLoading, setIsLoading] = React.useState(false);
              const [showConfirmModal, setShowConfirmModal] = React.useState(false);
              const [equipmentToDelete, setEquipmentToDelete] = React.useState(null);
              const [editingEquipment, setEditingEquipment] = React.useState(null); // State to hold the equipment being edited


              const equipmentTypes = ["BOMBA LAN√áA", "BOMBA", "BETONEIRA"];

              React.useEffect(() => {
                if (!userId) return;
                const fetchEquipment = async () => {
                  setIsLoading(true);
                  const { data, error: fetchError } = await supabase
                    .from('equipamentos')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });

                  if (fetchError) {
                    console.error("Erro ao buscar equipamentos no Supabase:", fetchError);
                    setError("Erro ao carregar equipamentos. Por favor, recarregue a p√°gina.");
                    showToast("Erro ao carregar equipamentos.", "error");
                  } else {
                    setEquipmentList(data);
                    setError(null);
                  }
                  setIsLoading(false);
                };
                fetchEquipment();
              }, [userId, showToast]);

              const handleAddOrUpdateEquipment = async (e) => {
                e.preventDefault();
                if (!newPlate.trim() || !newEquipmentType) {
                  setError("Por favor, preencha a placa e selecione o tipo de equipamento.");
                  showToast("Preencha todos os campos.", "error");
                  return;
                }
                setIsLoading(true);
                try {
                  if (editingEquipment) {
                    // Update existing equipment
                    const { error: updateError } = await supabase
                      .from('equipamentos')
                      .update({ plate: newPlate.trim(), type: newEquipmentType })
                      .eq('id', editingEquipment.id);

                    if (updateError) throw updateError;
                    showToast("Equipamento atualizado com sucesso!", "success");
                    setEditingEquipment(null); // Exit edit mode
                  } else {
                    // Add new equipment
                    const { error: insertError } = await supabase
                      .from('equipamentos')
                      .insert([
                        { plate: newPlate.trim(), type: newEquipmentType, created_by_username: userId }
                      ]);

                    if (insertError) throw insertError;
                    showToast("Equipamento adicionado com sucesso!", "success");
                  }

                  setNewPlate('');
                  setNewEquipmentType('');
                  setError(null);
                  // Re-fetch data
                  const { data, error: fetchError } = await supabase
                    .from('equipamentos')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar equipamentos:", fetchError);
                  else setEquipmentList(data);

                } catch (e) {
                  console.error("Erro ao salvar equipamento:", e);
                  setError(`Erro ao ${editingEquipment ? 'atualizar' : 'adicionar'} equipamento. Tente novamente.`);
                  showToast(`Erro ao ${editingEquipment ? 'atualizar' : 'adicionar'} equipamento.`, "error");
                }
                setIsLoading(false);
              };

              const handleEditEquipment = (equipment) => {
                setEditingEquipment(equipment);
                setNewPlate(equipment.plate);
                setNewEquipmentType(equipment.type);
                setError(null);
              };

              const handleCancelEdit = () => {
                setEditingEquipment(null);
                setNewPlate('');
                setNewEquipmentType('');
                setError(null);
              };

              const confirmDeleteEquipment = (equipment) => {
                setEquipmentToDelete(equipment);
                setShowConfirmModal(true);
              };

              const handleDeleteEquipment = async () => {
                if (!equipmentToDelete) return;

                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                  const { error: deleteError } = await supabase
                    .from('equipamentos')
                    .delete()
                    .eq('id', equipmentToDelete.id);

                  if (deleteError) throw deleteError;

                  showToast("Equipamento exclu√≠do com sucesso!", "success");
                  // Re-fetch data
                  const { data, error: fetchError } = await supabase
                    .from('equipamentos')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar equipamentos:", fetchError);
                  else setEquipmentList(data);

                } catch (e) {
                  console.error("Erro ao deletar equipamento:", e);
                  setError("Erro ao deletar equipamento. Tente novamente.");
                  showToast("Erro ao excluir equipamento.", "error");
                } finally {
                    setIsLoading(false);
                    setEquipmentToDelete(null);
                }
              };

              return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                  React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Equipamentos"),
                  error && (
                    React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                      React.createElement('strong', { className: "font-bold" }, "Erro:"),
                      React.createElement('span', { className: "block sm:inline" }, " ", error)
                    )
                  ),
                  React.createElement('form', { onSubmit: handleAddOrUpdateEquipment, className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" },
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "newPlate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Placa"),
                      React.createElement('input', {
                        type: "text",
                        id: "newPlate",
                        value: newPlate,
                        onChange: (e) => setNewPlate(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                        placeholder: "Ex: ABC-1234",
                        required: true,
                        disabled: isLoading
                      })
                    ),
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "newEquipmentType", className: "block text-sm font-medium text-gray-700 mb-1" }, "Tipo de Equipamento"),
                      React.createElement('select', {
                        id: "newEquipmentType",
                        value: newEquipmentType,
                        onChange: (e) => setNewEquipmentType(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                        required: true,
                        disabled: isLoading
                      },
                        React.createElement('option', { value: "" }, "Selecione um tipo"),
                        equipmentTypes.map((type) => (
                          React.createElement('option', { key: type, value: type }, type)
                        ))
                      )
                    ),
                    React.createElement('div', { className: "md:col-span-2 flex justify-center space-x-4" },
                      React.createElement('button', {
                        type: "submit",
                        className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                        disabled: isLoading
                      },
                        isLoading ? (
                          React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                          )
                        ) : (
                          React.createElement(LucideIcon, { name: editingEquipment ? "Edit" : "PlusCircle", className: "mr-2 h-5 w-5" })
                        ),
                        isLoading ? (editingEquipment ? 'Atualizando...' : 'Adicionando...') : (editingEquipment ? 'Atualizar Equipamento' : 'Adicionar Equipamento')
                      ),
                      editingEquipment && React.createElement('button', {
                          type: "button",
                          onClick: handleCancelEdit,
                          className: "inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                          disabled: isLoading
                      }, "Cancelar")
                    )
                  ),
                  React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                    React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                      React.createElement('thead', { className: "bg-gray-100" },
                        React.createElement('tr', null,
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Tipo"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                        )
                      ),
                      React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                        isLoading && equipmentList.length === 0 ? (
                            React.createElement('tr', null,
                                React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando equipamentos...")
                            )
                        ) : equipmentList.length === 0 ? (
                          React.createElement('tr', null,
                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhum equipamento cadastrado.")
                          )
                        ) : (
                          equipmentList.map((equipment) => (
                            React.createElement('tr', { key: equipment.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, equipment.plate),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, equipment.type),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                React.createElement('button', {
                                  onClick: () => handleEditEquipment(equipment),
                                  className: "text-blue-600 hover:text-blue-800 mr-4 transition-colors duration-150",
                                  title: "Editar Equipamento",
                                  disabled: isLoading
                                },
                                  React.createElement(LucideIcon, { name: "Edit", className: "h-5 w-5" })
                                ),
                                React.createElement('button', {
                                  onClick: () => confirmDeleteEquipment(equipment),
                                  className: "text-red-600 hover:text-red-800 transition-colors duration-150",
                                  title: "Excluir Equipamento",
                                  disabled: isLoading
                                },
                                  React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                )
                              )
                            )
                          ))
                        )
                      )
                    )
                  ),
                  showConfirmModal && React.createElement(ConfirmationModal, {
                      message: `Tem certeza que deseja excluir o equipamento de placa "${equipmentToDelete?.plate}"?`,
                      onConfirm: handleDeleteEquipment,
                      onCancel: () => setShowConfirmModal(false)
                  })
                )
              );
            }

            // Novo Componente: Gerenciamento de Usu√°rios
            function UserManagement({ userId, showToast }) {
              const [newUsername, setNewUsername] = React.useState('');
              const [newPassword, setNewPassword] = React.useState('');
              const [newUserRole, setNewUserRole] = React.useState('usuario');
              const [usersList, setUsersList] = React.useState([]);
              const [error, setError] = React.useState(null);
              const [isLoading, setIsLoading] = React.useState(false);
              const [showConfirmModal, setShowConfirmModal] = React.useState(false);
              const [userToDelete, setUserToDelete] = React.useState(null);
              const [editingUser, setEditingUser] = React.useState(null); // State to hold the user being edited


              const roles = ['administrador', 'supervisor', 'usuario'];

              React.useEffect(() => {
                if (!userId) return;
                const fetchUsers = async () => {
                  setIsLoading(true);
                  const { data, error: fetchError } = await supabase
                    .from('app_users') // Public table
                    .select('*')
                    .order('created_at', { ascending: false });

                  if (fetchError) {
                    console.error("Erro ao buscar usu√°rios no Supabase:", fetchError);
                    setError("Erro ao carregar usu√°rios. Por favor, recarregue a p√°gina.");
                    showToast("Erro ao carregar usu√°rios.", "error");
                  } else {
                    setUsersList(data);
                    setError(null);
                  }
                  setIsLoading(false);
                };
                fetchUsers();
              }, [userId, showToast]);

              const handleAddOrUpdateUser = async (e) => {
                e.preventDefault();
                if (!newUsername.trim() || !newPassword.trim()) {
                  setError("Por favor, preencha o nome de usu√°rio e a senha.");
                  showToast("Preencha o nome de usu√°rio e a senha.", "error");
                  return;
                }
                setIsLoading(true);
                try {
                  if (editingUser) {
                    // Update existing user
                    const { error: updateError } = await supabase
                      .from('app_users')
                      .update({ username: newUsername.trim(), password: newPassword, role: newUserRole })
                      .eq('id', editingUser.id);

                    if (updateError) throw updateError;
                    showToast("Usu√°rio atualizado com sucesso!", "success");
                    setEditingUser(null); // Exit edit mode
                  } else {
                    // Add new user
                    const { error: insertError } = await supabase
                      .from('app_users') // Public table
                      .insert([
                        { username: newUsername.trim(), password: newPassword, role: newUserRole }
                      ]);

                    if (insertError) throw insertError;
                    showToast("Usu√°rio adicionado com sucesso!", "success");
                  }

                  setNewUsername('');
                  setNewPassword('');
                  setNewUserRole('usuario');
                  setError(null);
                  // Re-fetch data
                  const { data, error: fetchError } = await supabase
                    .from('app_users')
                    .select('*')
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar usu√°rios:", fetchError);
                  else setUsersList(data);

                } catch (e) {
                  console.error("Erro ao salvar usu√°rio:", e);
                  setError(`Erro ao ${editingUser ? 'atualizar' : 'adicionar'} usu√°rio. Tente novamente.`);
                  showToast(`Erro ao ${editingUser ? 'atualizar' : 'adicionar'} usu√°rio.`, "error");
                }
                setIsLoading(false);
              };

              const handleEditUser = (user) => {
                setEditingUser(user);
                setNewUsername(user.username);
                setNewPassword(user.password); // In a real app, you wouldn't pre-fill passwords
                setNewUserRole(user.role);
                setError(null);
              };

              const handleCancelEdit = () => {
                setEditingUser(null);
                setNewUsername('');
                setNewPassword('');
                setNewUserRole('usuario');
                setError(null);
              };

              const confirmDeleteUser = (user) => {
                setUserToDelete(user);
                setShowConfirmModal(true);
              };

              const handleDeleteUser = async () => {
                if (!userToDelete) return;

                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                  const { error: deleteError } = await supabase
                    .from('app_users') // Public table
                    .delete()
                    .eq('id', userToDelete.id);

                  if (deleteError) throw deleteError;

                  showToast("Usu√°rio exclu√≠do com sucesso!", "success");
                  // Re-fetch data
                  const { data, error: fetchError } = await supabase
                    .from('app_users')
                    .select('*')
                    .order('created_at', { ascending: false });
                  if (fetchError) console.error("Erro ao re-buscar usu√°rios:", fetchError);
                  else setUsersList(data);

                } catch (e) {
                  console.error("Erro ao deletar usu√°rio:", e);
                  setError("Erro ao deletar usu√°rio. Tente novamente.");
                  showToast("Erro ao excluir usu√°rio.", "error");
                } finally {
                    setIsLoading(false);
                    setUserToDelete(null);
                }
              };

              return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                  React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Usu√°rios"),
                  error && (
                    React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                      React.createElement('strong', { className: "font-bold" }, "Erro:"),
                      React.createElement('span', { className: "block sm:inline" }, " ", error)
                    )
                  ),
                  React.createElement('form', { onSubmit: handleAddOrUpdateUser, className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" },
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "newUsername", className: "block text-sm font-medium text-gray-700 mb-1" }, "Nome de Usu√°rio"),
                      React.createElement('input', {
                        type: "text",
                        id: "newUsername",
                        value: newUsername,
                        onChange: (e) => setNewUsername(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                        placeholder: "Ex: joao.silva@empresa.com",
                        required: true,
                        disabled: isLoading
                      })
                    ),
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "newPassword", className: "block text-sm font-medium text-gray-700 mb-1" }, "Senha"),
                      React.createElement('input', {
                        type: "password",
                        id: "newPassword",
                        value: newPassword,
                        onChange: (e) => setNewPassword(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                        placeholder: "Digite a senha",
                        required: true,
                        disabled: isLoading
                      })
                    ),
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "newUserRole", className: "block text-sm font-medium text-gray-700 mb-1" }, "Fun√ß√£o"),
                      React.createElement('select', {
                        id: "newUserRole",
                        value: newUserRole,
                        onChange: (e) => setNewUserRole(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                        required: true,
                        disabled: isLoading
                      },
                        roles.map((role) => (
                          React.createElement('option', { key: role, value: role }, role.charAt(0).toUpperCase() + role.slice(1))
                        ))
                      )
                    ),
                    React.createElement('div', { className: "md:col-span-2 flex justify-center space-x-4" },
                      React.createElement('button', {
                        type: "submit",
                        className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                        disabled: isLoading
                      },
                        isLoading ? (
                          React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                          )
                        ) : (
                          React.createElement(LucideIcon, { name: editingUser ? "Edit" : "PlusCircle", className: "mr-2 h-5 w-5" })
                        ),
                        isLoading ? (editingUser ? 'Atualizando...' : 'Adicionando...') : (editingUser ? 'Atualizar Usu√°rio' : 'Adicionar Usu√°rio')
                      ),
                      editingUser && React.createElement('button', {
                          type: "button",
                          onClick: handleCancelEdit,
                          className: "inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                          disabled: isLoading
                      }, "Cancelar")
                    )
                  ),
                  React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                    React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                      React.createElement('thead', { className: "bg-gray-100" },
                        React.createElement('tr', null,
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Usu√°rio"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Fun√ß√£o"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                        )
                      ),
                      React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                        isLoading && usersList.length === 0 ? (
                            React.createElement('tr', null,
                                React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando usu√°rios...")
                            )
                        ) : usersList.length === 0 ? (
                          React.createElement('tr', null,
                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhum usu√°rio cadastrado.")
                          )
                        ) : (
                          usersList.map((user) => (
                            React.createElement('tr', { key: user.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, user.username),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize" }, user.role),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                React.createElement('button', {
                                  onClick: () => handleEditUser(user),
                                  className: "text-blue-600 hover:text-blue-800 mr-4 transition-colors duration-150",
                                  title: "Editar Usu√°rio",
                                  disabled: isLoading
                                },
                                  React.createElement(LucideIcon, { name: "Edit", className: "h-5 w-5" })
                                ),
                                React.createElement('button', {
                                  onClick: () => confirmDeleteUser(user),
                                  className: "text-red-600 hover:text-red-800 transition-colors duration-150",
                                  title: "Excluir Usu√°rio",
                                  disabled: isLoading
                                },
                                  React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                )
                              )
                            )
                          ))
                        )
                      )
                    )
                  ),
                  showConfirmModal && React.createElement(ConfirmationModal, {
                      message: `Tem certeza que deseja excluir o usu√°rio "${userToDelete?.username}"?`,
                      onConfirm: handleDeleteUser,
                      onCancel: () => setShowConfirmModal(false)
                  })
                )
              );
            }

            // Componente para Gerenciamento de Regionais (Novo)
            function RegionalManagement({ userId, showToast }) {
                const [newRegionalName, setNewRegionalName] = React.useState('');
                const [availableBranches, setAvailableBranches] = React.useState([]);
                const [selectedBranches, setSelectedBranches] = React.useState([]);
                const [regionalsList, setRegionalsList] = React.useState([]);
                const [error, setError] = React.useState(null);
                const [isLoading, setIsLoading] = React.useState(false);
                const [showConfirmModal, setShowConfirmModal] = React.useState(false);
                const [regionalToDelete, setRegionalToDelete] = React.useState(null);
                const [editingRegional, setEditingRegional] = React.useState(null); // State to hold the regional being edited


                React.useEffect(() => {
                    if (!userId) return;

                    const fetchBranchesAndRegionals = async () => {
                        setIsLoading(true);
                        const { data: branchesData, error: branchesError } = await supabase
                            .from('filiais')
                            .select('name')
                            .eq('created_by_username', userId)
                            .order('name', { ascending: true });

                        if (branchesError) {
                            console.error("Erro ao buscar filiais para regionais no Supabase:", branchesError);
                            setError("Erro ao carregar filiais. Por favor, recarregue a p√°gina.");
                            showToast("Erro ao carregar filiais.", "error");
                        } else {
                            setAvailableBranches(branchesData.map(b => b.name));
                        }

                        const { data: regionalsData, error: regionalsError } = await supabase
                            .from('regionais')
                            .select('*')
                            .eq('created_by_username', userId)
                            .order('created_at', { ascending: false });

                        if (regionalsError) {
                            console.error("Erro ao buscar regionais no Supabase:", regionalsError);
                            setError("Erro ao carregar regionais. Por favor, recarregue a p√°gina.");
                            showToast("Erro ao carregar regionais.", "error");
                        } else {
                            setRegionalsList(regionalsData);
                            setError(null);
                        }
                        setIsLoading(false);
                    };

                    fetchBranchesAndRegionals();
                }, [userId, showToast]);

                const handleAddOrUpdateRegional = async (e) => {
                    e.preventDefault();
                    if (!newRegionalName.trim()) {
                        setError("O nome da regional n√£o pode estar vazio.");
                        showToast("O nome da regional n√£o pode estar vazio.", "error");
                        return;
                    }
                    if (selectedBranches.length === 0) {
                        setError("Selecione pelo menos uma filial para a regional.");
                        showToast("Selecione pelo menos uma filial.", "error");
                        return;
                    }

                    setIsLoading(true);
                    try {
                        if (editingRegional) {
                            // Update existing regional
                            const { error: updateError } = await supabase
                                .from('regionais')
                                .update({ name: newRegionalName.trim(), responsible_branches: selectedBranches })
                                .eq('id', editingRegional.id);

                            if (updateError) throw updateError;
                            showToast("Regional atualizada com sucesso!", "success");
                            setEditingRegional(null); // Exit edit mode
                        } else {
                            // Add new regional
                            const { error: insertError } = await supabase
                                .from('regionais')
                                .insert([
                                    { name: newRegionalName.trim(), responsible_branches: selectedBranches, created_by_username: userId }
                                ]);

                            if (insertError) throw insertError;
                            showToast("Regional adicionada com sucesso!", "success");
                        }

                        setNewRegionalName('');
                        setSelectedBranches([]);
                        setError(null);
                        // Re-fetch data to update the list
                        const { data, error: fetchError } = await supabase
                            .from('regionais')
                            .select('*')
                            .eq('created_by_username', userId)
                            .order('created_at', { ascending: false });
                        if (fetchError) console.error("Erro ao re-buscar regionais:", fetchError);
                        else setRegionalsList(data);

                    } catch (e) {
                        console.error("Erro ao salvar regional:", e);
                        setError(`Erro ao ${editingRegional ? 'atualizar' : 'adicionar'} regional. Tente novamente.`);
                        showToast(`Erro ao ${editingRegional ? 'atualizar' : 'adicionar'} regional.`, "error");
                    }
                    setIsLoading(false);
                };

                const handleEditRegional = (regional) => {
                    setEditingRegional(regional);
                    setNewRegionalName(regional.name);
                    setSelectedBranches(regional.responsible_branches || []);
                    setError(null);
                };

                const handleCancelEdit = () => {
                    setEditingRegional(null);
                    setNewRegionalName('');
                    setSelectedBranches([]);
                    setError(null);
                };

                const confirmDeleteRegional = (regional) => {
                    setRegionalToDelete(regional);
                    setShowConfirmModal(true);
                };

                const handleDeleteRegional = async () => {
                    if (!regionalToDelete) return;

                    setIsLoading(true);
                    setShowConfirmModal(false); // Close modal
                    try {
                        const { error: deleteError } = await supabase
                            .from('regionais')
                            .delete()
                            .eq('id', regionalToDelete.id);

                        if (deleteError) throw deleteError;

                        showToast("Regional exclu√≠da com sucesso!", "success");
                        // Re-fetch data to update the list
                        const { data, error: fetchError } = await supabase
                            .from('regionais')
                            .select('*')
                            .eq('created_by_username', userId)
                            .order('created_at', { ascending: false });
                        if (fetchError) console.error("Erro ao re-buscar regionais:", fetchError);
                        else setRegionalsList(data);

                    } catch (e) {
                        console.error("Erro ao deletar regional:", e);
                        setError("Erro ao deletar regional. Tente novamente.");
                        showToast("Erro ao excluir regional.", "error");
                    } finally {
                        setIsLoading(false);
                        setRegionalToDelete(null);
                    }
                };

                const handleBranchSelection = (branchName) => {
                    setSelectedBranches(prev =>
                        prev.includes(branchName)
                            ? prev.filter(name => name !== branchName)
                            : [...prev, branchName]
                    );
                };

                return (
                    React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                        React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Regionais"),
                        error && (
                            React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                                React.createElement('strong', { className: "font-bold" }, "Erro:"),
                                React.createElement('span', { className: "block sm:inline" }, " ", error)
                            )
                        ),
                        React.createElement('form', { onSubmit: handleAddOrUpdateRegional, className: "space-y-6 mb-6" },
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "newRegionalName", className: "block text-sm font-medium text-gray-700 mb-1" }, "Nome da Regional"),
                                React.createElement('input', {
                                    type: "text",
                                    id: "newRegionalName",
                                    value: newRegionalName,
                                    onChange: (e) => setNewRegionalName(e.target.value),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    placeholder: "Ex: Regional Nordeste",
                                    required: true,
                                    disabled: isLoading
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Filiais Respons√°veis:"),
                                React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 max-h-48 overflow-y-auto border border-gray-300 rounded-md p-3" },
                                    isLoading && availableBranches.length === 0 ? (
                                        React.createElement('p', { className: "text-sm text-gray-500 col-span-full" }, "Carregando filiais...")
                                    ) : availableBranches.length === 0 ? (
                                        React.createElement('p', { className: "text-sm text-gray-500 col-span-full" }, "Nenhuma filial dispon√≠vel. Cadastre filiais primeiro.")
                                    ) : (
                                        availableBranches.map(branchName => (
                                            React.createElement('div', { key: branchName, className: "flex items-center" },
                                                React.createElement('input', {
                                                    type: "checkbox",
                                                    id: `branch-${branchName}`,
                                                    checked: selectedBranches.includes(branchName),
                                                    onChange: () => handleBranchSelection(branchName),
                                                    className: "h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 transition duration-150 ease-in-out",
                                                    disabled: isLoading
                                                }),
                                                React.createElement('label', { htmlFor: `branch-${branchName}`, className: "ml-2 text-sm text-gray-700" }, branchName)
                                            )
                                        ))
                                    )
                                )
                            ),
                            React.createElement('div', { className: "flex justify-center space-x-4" },
                                React.createElement('button', {
                                    type: "submit",
                                    className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                    disabled: isLoading
                                },
                                    isLoading ? (
                                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill="none", viewBox="0 0 24 24" },
                                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth: "4" }),
                                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                        )
                                    ) : (
                                        React.createElement(LucideIcon, { name: editingRegional ? "Edit" : "PlusCircle", className: "mr-2 h-5 w-5" })
                                    ),
                                    isLoading ? (editingRegional ? 'Atualizando...' : 'Adicionando...') : (editingRegional ? 'Atualizar Regional' : 'Adicionar Regional')
                                ),
                                editingRegional && React.createElement('button', {
                                    type: "button",
                                    onClick: handleCancelEdit,
                                    className: "inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                    disabled: isLoading
                                }, "Cancelar")
                            )
                        ),
                        React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                            React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                                React.createElement('thead', { className: "bg-gray-100" },
                                    React.createElement('tr', null,
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Regional"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filiais Respons√°veis"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                                    )
                                ),
                                React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                    isLoading && regionalsList.length === 0 ? (
                                        React.createElement('tr', null,
                                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando regionais...")
                                        )
                                    ) : regionalsList.length === 0 ? (
                                        React.createElement('tr', null,
                                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhuma regional cadastrada.")
                                        )
                                    ) : (
                                        regionalsList.map((regional) => (
                                            React.createElement('tr', { key: regional.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, regional.name),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" },
                                                    regional.responsible_branches && regional.responsible_branches.length > 0
                                                        ? regional.responsible_branches.join(', ')
                                                        : 'N/A'
                                                ),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                    React.createElement('button', {
                                                        onClick: () => handleEditRegional(regional),
                                                        className: "text-blue-600 hover:text-blue-800 mr-4 transition-colors duration-150",
                                                        title: "Editar Regional",
                                                        disabled: isLoading
                                                    },
                                                        React.createElement(LucideIcon, { name: "Edit", className: "h-5 w-5" })
                                                    ),
                                                    React.createElement('button', {
                                                        onClick: () => confirmDeleteRegional(regional),
                                                        className: "text-red-600 hover:text-red-800 transition-colors duration-150",
                                                        title: "Excluir Regional",
                                                        disabled: isLoading
                                                    },
                                                        React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                                    )
                                                )
                                            )
                                        ))
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Novo Componente: Gerenciamento de Usinas (Plants)
            function PlantManagement({ userId, showToast }) {
                const [newPlantName, setNewPlantName] = React.useState('');
                const [selectedBranch, setSelectedBranch] = React.useState('');
                const [availableBranches, setAvailableBranches] = React.useState([]);
                const [plantsList, setPlantsList] = React.useState([]);
                const [error, setError] = React.useState(null);
                const [isLoading, setIsLoading] = React.useState(false);
                const [showConfirmModal, setShowConfirmModal] = React.useState(false);
                const [plantToDelete, setPlantToDelete] = React.useState(null);
                const [editingPlant, setEditingPlant] = React.useState(null); // State to hold the plant being edited


                React.useEffect(() => {
                    if (!userId) return;

                    const fetchBranchesAndPlants = async () => {
                        setIsLoading(true);
                        const { data: branchesData, error: branchesError } = await supabase
                            .from('filiais')
                            .select('name')
                            .eq('created_by_username', userId)
                            .order('name', { ascending: true });

                        if (branchesError) {
                            console.error("Erro ao buscar filiais para usinas no Supabase:", branchesError);
                            setError("Erro ao carregar filiais. Por favor, recarregue a p√°gina.");
                            showToast("Erro ao carregar filiais.", "error");
                        } else {
                            setAvailableBranches(branchesData.map(b => b.name));
                        }

                        const { data: plantsData, error: plantsError } = await supabase
                            .from('usinas')
                            .select('*')
                            .eq('created_by_username', userId)
                            .order('created_at', { ascending: false });

                        if (plantsError) {
                            console.error("Erro ao buscar usinas no Supabase:", plantsError);
                            setError("Erro ao carregar usinas. Por favor, recarregue a p√°gina.");
                            showToast("Erro ao carregar usinas.", "error");
                        } else {
                            setPlantsList(plantsData);
                            setError(null);
                        }
                        setIsLoading(false);
                    };

                    fetchBranchesAndPlants();
                }, [userId, showToast]);

                const handleAddOrUpdatePlant = async (e) => {
                    e.preventDefault();
                    if (!newPlantName.trim()) {
                        setError("O nome da usina n√£o pode estar vazio.");
                        showToast("O nome da usina n√£o pode estar vazio.", "error");
                        return;
                    }
                    if (!selectedBranch) {
                        setError("Selecione uma filial para a usina.");
                        showToast("Selecione uma filial para a usina.", "error");
                        return;
                    }

                    setIsLoading(true);
                    try {
                        if (editingPlant) {
                            // Update existing plant
                            const { error: updateError } = await supabase
                                .from('usinas')
                                .update({ name: newPlantName.trim(), branch_name: selectedBranch })
                                .eq('id', editingPlant.id);

                            if (updateError) throw updateError;
                            showToast("Usina atualizada com sucesso!", "success");
                            setEditingPlant(null); // Exit edit mode
                        } else {
                            // Add new plant
                            const { error: insertError } = await supabase
                                .from('usinas')
                                .insert([
                                    { name: newPlantName.trim(), branch_name: selectedBranch, created_by_username: userId }
                                ]);

                            if (insertError) throw insertError;
                            showToast("Usina adicionada com sucesso!", "success");
                        }

                        setNewPlantName('');
                        setSelectedBranch('');
                        setError(null);
                        // Re-fetch data to update the list
                        const { data, error: fetchError } = await supabase
                            .from('usinas')
                            .select('*')
                            .eq('created_by_username', userId)
                            .order('created_at', { ascending: false });
                        if (fetchError) console.error("Erro ao re-buscar usinas:", fetchError);
                        else setPlantsList(data);

                    } catch (e) {
                        console.error("Erro ao salvar usina:", e);
                        setError(`Erro ao ${editingPlant ? 'atualizar' : 'adicionar'} usina. Tente novamente.`);
                        showToast(`Erro ao ${editingPlant ? 'atualizar' : 'adicionar'} usina.`, "error");
                    }
                    setIsLoading(false);
                };

                const handleEditPlant = (plant) => {
                    setEditingPlant(plant);
                    setNewPlantName(plant.name);
                    setSelectedBranch(plant.branch_name);
                    setError(null);
                };

                const handleCancelEdit = () => {
                    setEditingPlant(null);
                    setNewPlantName('');
                    setSelectedBranch('');
                    setError(null);
                };

                const confirmDeletePlant = (plant) => {
                    setPlantToDelete(plant);
                    setShowConfirmModal(true);
                };

                const handleDeletePlant = async () => {
                    if (!plantToDelete) return;

                    setIsLoading(true);
                    setShowConfirmModal(false); // Close modal
                    try {
                        const { error: deleteError } = await supabase
                            .from('usinas')
                            .delete()
                            .eq('id', plantToDelete.id);

                        if (deleteError) throw deleteError;

                        showToast("Usina exclu√≠da com sucesso!", "success");
                        // Re-fetch data to update the list
                        const { data, error: fetchError } = await supabase
                            .from('usinas')
                            .select('*')
                            .eq('created_by_username', userId)
                            .order('created_at', { ascending: false });
                        if (fetchError) console.error("Erro ao re-buscar usinas:", fetchError);
                        else setPlantsList(data);

                    } catch (e) {
                        console.error("Erro ao deletar usina:", e);
                        setError("Erro ao deletar usina. Tente novamente.");
                        showToast("Erro ao excluir usina.", "error");
                    } finally {
                        setIsLoading(false);
                        setPlantToDelete(null);
                    }
                };

                return (
                    React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                        React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Usinas"),
                        error && (
                            React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                                React.createElement('strong', { className: "font-bold" }, "Erro:"),
                                React.createElement('span', { className: "block sm:inline" }, " ", error)
                            )
                        ),
                        React.createElement('form', { onSubmit: handleAddOrUpdatePlant, className: "space-y-6 mb-6" },
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "newPlantName", className: "block text-sm font-medium text-gray-700 mb-1" }, "Nome da Usina"),
                                React.createElement('input', {
                                    type: "text",
                                    id: "newPlantName",
                                    value: newPlantName,
                                    onChange: (e) => setNewPlantName(e.target.value),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    placeholder: "Ex: Usina A",
                                    required: true,
                                    disabled: isLoading
                                })
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { htmlFor: "selectedBranch", className: "block text-sm font-medium text-gray-700 mb-1" }, "Filial Associada:"),
                                React.createElement('select', {
                                    id: "selectedBranch",
                                    value: selectedBranch,
                                    onChange: (e) => setSelectedBranch(e.target.value),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    required: true,
                                    disabled: isLoading
                                },
                                    React.createElement('option', { value: "" }, "Selecione uma filial"),
                                    availableBranches.length === 0 ? (
                                        React.createElement('option', { disabled: true }, "Nenhuma filial dispon√≠vel")
                                    ) : (
                                        availableBranches.map(branchName => (
                                            React.createElement('option', { key: branchName, value: branchName }, branchName)
                                        ))
                                    )
                                )
                            ),
                            React.createElement('div', { className: "flex justify-center space-x-4" },
                                React.createElement('button', {
                                    type: "submit",
                                    className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                    disabled: isLoading
                                },
                                    isLoading ? (
                                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill="none", viewBox="0 0 24 24" },
                                            React.createElement('circle', { cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth: "4" }),
                                            React.createElement('path', { className: "opacity-25", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                        )
                                    ) : (
                                        React.createElement(LucideIcon, { name: editingPlant ? "Edit" : "PlusCircle", className: "mr-2 h-5 w-5" })
                                    ),
                                    isLoading ? (editingPlant ? 'Atualizando...' : 'Adicionando...') : (editingPlant ? 'Atualizar Usina' : 'Adicionar Usina')
                                ),
                                editingPlant && React.createElement('button', {
                                    type: "button",
                                    onClick: handleCancelEdit,
                                    className: "inline-flex items-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                    disabled: isLoading
                                }, "Cancelar")
                            )
                        ),
                        React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                            React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                                React.createElement('thead', { className: "bg-gray-100" },
                                    React.createElement('tr', null,
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Usina"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filial Associada"),
                                        React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "A√ß√µes")
                                    )
                                ),
                                React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                    isLoading && plantsList.length === 0 ? (
                                        React.createElement('tr', null,
                                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando usinas...")
                                        )
                                    ) : plantsList.length === 0 ? (
                                        React.createElement('tr', null,
                                            React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhuma usina cadastrada.")
                                        )
                                    ) : (
                                        plantsList.map((plant) => (
                                            React.createElement('tr', { key: plant.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, plant.name),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, plant.branch_name),
                                                React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                    React.createElement('button', {
                                                        onClick: () => handleEditPlant(plant),
                                                        className: "text-blue-600 hover:text-blue-800 mr-4 transition-colors duration-150",
                                                        title: "Editar Usina",
                                                        disabled: isLoading
                                                    },
                                                        React.createElement(LucideIcon, { name: "Edit", className: "h-5 w-5" })
                                                    ),
                                                    React.createElement('button', {
                                                        onClick: () => confirmDeletePlant(plant),
                                                        className: "text-red-600 hover:text-red-800 transition-colors duration-150",
                                                        title: "Excluir Usina",
                                                        disabled: isLoading
                                                    },
                                                        React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                                    )
                                                )
                                            )
                                        ))
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Componente para Troca de Filial
            function BranchTransfer({ userId, setCurrentPage, showToast }) {
              const [selectedPlate, setSelectedPlate] = React.useState(''); // Changed from newPlate to selectedPlate
              const [newBranch, setNewBranch] = React.useState('');
              const [executionDate, setExecutionDate] = React.useState('');
              const [availableBranches, setAvailableBranches] = React.useState([]); // Renamed from branches
              const [availableEquipment, setAvailableEquipment] = React.useState([]); // New state for equipment dropdown
              const [error, setError] = React.useState(null);
              const [isLoading, setIsLoading] = React.useState(false);


              React.useEffect(() => {
                if (!userId) return;
                const fetchData = async () => {
                  setIsLoading(true);
                  // Fetch branches
                  const { data: branchesData, error: branchesError } = await supabase
                    .from('filiais')
                    .select('name')
                    .eq('created_by_username', userId)
                    .order('name', { ascending: true });

                  if (branchesError) {
                    console.error("Erro ao buscar filiais no Supabase:", branchesError);
                    setError("Erro ao carregar filiais para sele√ß√£o. Por favor, recarregue a p√°gina.");
                    showToast("Erro ao carregar filiais.", "error");
                  } else {
                    setAvailableBranches(branchesData.map(b => b.name));
                  }

                  // Fetch equipment plates
                  const { data: equipmentData, error: equipmentError } = await supabase
                    .from('equipamentos')
                    .select('plate')
                    .eq('created_by_username', userId)
                    .order('plate', { ascending: true });

                  if (equipmentError) {
                    console.error("Erro ao buscar equipamentos no Supabase:", equipmentError);
                    setError("Erro ao carregar placas de equipamento. Por favor, recarregue a p√°gina.");
                    showToast("Erro ao carregar equipamentos.", "error");
                  } else {
                    setAvailableEquipment(equipmentData.map(e => e.plate));
                  }
                  setIsLoading(false);
                };
                fetchData();
              }, [userId, showToast]);

              const handleRegisterTransfer = async (e) => {
                e.preventDefault();
                setError(null);
                if (!selectedPlate || !newBranch || !executionDate) { // Changed from plate to selectedPlate
                  setError("Por favor, preencha todos os campos.");
                  showToast("Preencha todos os campos.", "error");
                  return;
                }

                setIsLoading(true);
                try {
                  const { error: insertError } = await supabase
                    .from('trocasFilial')
                    .insert([
                      { plate: selectedPlate, newBranch: newBranch, executionDate: executionDate, created_by_username: userId } // Changed from plate to selectedPlate
                    ]);

                  if (insertError) throw insertError;

                  showToast("Troca de filial registrada com sucesso!", "success");
                  setSelectedPlate(''); // Changed from newPlate to selectedPlate
                  setNewBranch('');
                  setExecutionDate('');
                } catch (e) {
                  console.error("Erro ao registrar troca de filial:", e);
                  setError("Erro ao registrar troca de filial. Tente novamente.");
                  showToast("Erro ao registrar troca de filial.", "error");
                } finally {
                    setIsLoading(false);
                }
              };

              const handleGoBack = () => {
                setCurrentPage('dashboard');
              };

              return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg w-full max-w-2xl mx-auto" },
                  React.createElement('div', { className: "flex items-center mb-6" },
                    React.createElement('button', {
                      onClick: handleGoBack,
                      className: "inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out transform hover:scale-105",
                      disabled: isLoading
                    },
                      React.createElement(LucideIcon, { name: "ArrowLeft", className: "mr-2 h-5 w-5" }),
                      "Voltar"
                    ),
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 flex-grow text-center" }, "Troca de Filial Fixo de Equipamento")
                  ),
                  error && (
                    React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                      React.createElement('strong', { className: "font-bold" }, "Erro:"),
                      React.createElement('span', { className: "block sm:inline" }, " ", error)
                    )
                  ),
                  React.createElement('form', { onSubmit: handleRegisterTransfer, className: "space-y-6" },
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "selectedPlate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Placa do Equipamento:"),
                      React.createElement('div', { className: "relative" },
                        React.createElement('select', {
                          id: "selectedPlate",
                          value: selectedPlate,
                          onChange: (e) => setSelectedPlate(e.target.value),
                          className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm appearance-none pr-8 transition duration-150 ease-in-out",
                          required: true,
                          disabled: isLoading
                        },
                          React.createElement('option', { value: "" }, "Selecione a placa..."),
                          isLoading && availableEquipment.length === 0 ? (
                            React.createElement('option', { disabled: true }, "Carregando placas...")
                          ) : (
                            availableEquipment.map((plateOption) => (
                              React.createElement('option', { key: plateOption, value: plateOption }, plateOption)
                            ))
                          )
                        ),
                        React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5 text-gray-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none" })
                      )
                    ),
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "newBranch", className: "block text-sm font-medium text-gray-700 mb-1" }, "Nova Filial:"),
                      React.createElement('div', { className: "relative" },
                        React.createElement('select', {
                          id: "newBranch",
                          value: newBranch,
                          onChange: (e) => setNewBranch(e.target.value),
                          className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm appearance-none pr-8 transition duration-150 ease-in-out",
                          required: true,
                          disabled: isLoading
                        },
                          React.createElement('option', { value: "" }, "Selecione..."),
                          isLoading && availableBranches.length === 0 ? (
                            React.createElement('option', { disabled: true }, "Carregando filiais...")
                          ) : (
                            availableBranches.map((branchName) => (
                              React.createElement('option', { key: branchName, value: branchName }, branchName)
                            ))
                          )
                        ),
                        React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5 text-gray-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none" })
                      )
                    ),
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: "executionDate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Data de Execu√ß√£o:"),
                      React.createElement('div', { className: "relative" },
                        React.createElement('input', {
                          type: "date",
                          id: "executionDate",
                          value: executionDate,
                          onChange: (e) => setExecutionDate(e.target.value),
                          className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                          required: true,
                          disabled: isLoading
                        }),
                        React.createElement(LucideIcon, { name: "CalendarDays", className: "h-5 w-5 text-gray-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none" })
                      )
                    ),
                    React.createElement('button', {
                      type: "submit",
                      className: "w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                      disabled: isLoading
                    },
                      isLoading ? (
                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill="none", viewBox="0 0 24 24" },
                          React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth: "4" }),
                          React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                        )
                      ) : (
                        "Registrar Troca"
                      )
                    )
                  )
                )
              );
            }


            // Novo Componente: Dashboard (agora com funcionalidades de altera√ß√£o de placas)
            function Dashboard({ userId, showToast }) {
              const [equipmentCounts, setEquipmentCounts] = React.useState({
                'BOMBA LAN√áA': 0,
                'BOMBA': 0,
                'BETONEIRA': 0
              });
              const [animatedCounts, setAnimatedCounts] = React.useState({
                'BOMBA LAN√áA': 0,
                'BOMBA': 0,
                'BETONEIRA': 0
              });
              const [totalBranches, setTotalBranches] = React.useState(0);
              const [totalUsers, setTotalUsers] = React.useState(0);
              const [totalRegionals, setTotalRegionals] = React.useState(0);
              const [totalPlants, setTotalPlants] = React.useState(0);
              const [recentTransfers, setRecentTransfers] = React.useState([]); // New state for recent transfers

              const [registros, setRegistros] = React.useState([]);
              const [searchTerm, setSearchTerm] = React.useState('');
              const [error, setError] = React.useState(null);
              const [startDate, setStartDate] = React.useState('');
              const [endDate, setEndDate] = React.useState('');
              const [selectedUser, setSelectedUser] = React.useState('Todos os Respons√°veis');
              const [availableUsers, setAvailableUsers] = React.useState(['Todos os Respons√°veis']);
              const [isLoading, setIsLoading] = React.useState(false);

              // Animated counter effect
              const animateCount = (targetCount, type) => {
                  let start = 0;
                  const duration = 1000; // 1 second
                  const increment = targetCount / (duration / 16); // ~60 frames per second

                  const step = () => {
                      start += increment;
                      if (start < targetCount) {
                          setAnimatedCounts(prev => ({ ...prev, [type]: Math.ceil(start) }));
                          requestAnimationFrame(step);
                      } else {
                          setAnimatedCounts(prev => ({ ...prev, [type]: targetCount }));
                      }
                  };
                  requestAnimationFrame(step);
              };


              React.useEffect(() => {
                if (!userId) return;

                const fetchDashboardData = async () => {
                  setIsLoading(true);

                  // Fetch available users
                  const { data: usersData, error: usersError } = await supabase
                    .from('app_users') // Public table
                    .select('username');
                  if (usersError) {
                    console.error("Erro ao buscar usu√°rios dispon√≠veis no Supabase:", usersError);
                    setError("Erro ao carregar lista de usu√°rios.");
                    showToast("Erro ao carregar usu√°rios.", "error");
                  } else {
                    setAvailableUsers(['Todos os Respons√°veis', ...usersData.map(u => u.username)]);
                    setTotalUsers(usersData.length);
                  }

                  // Fetch equipment counts
                  const { data: equipmentData, error: equipmentError } = await supabase
                    .from('equipamentos')
                    .select('type')
                    .eq('created_by_username', userId);
                  if (equipmentError) {
                    console.error("Erro ao buscar contagem de equipamentos no Supabase:", equipmentError);
                    setError("Erro ao carregar dados de equipamentos.");
                    showToast("Erro ao carregar dados de equipamentos.", "error");
                  } else {
                    const counts = {
                      'BOMBA LAN√áA': 0,
                      'BOMBA': 0,
                      'BETONEIRA': 0
                    };
                    equipmentData.forEach(item => {
                      if (counts.hasOwnProperty(item.type)) {
                        counts[item.type]++;
                      }
                    });
                    setEquipmentCounts(counts);
                    Object.keys(counts).forEach(type => {
                        animateCount(counts[type], type);
                    });
                  }

                  // Fetch total branches
                  const { data: branchesData, error: branchesError } = await supabase
                    .from('filiais')
                    .select('id')
                    .eq('created_by_username', userId);
                  if (branchesError) {
                    console.error("Erro ao buscar filiais no Supabase:", branchesError);
                    setError("Erro ao carregar total de filiais.");
                    showToast("Erro ao carregar filiais.", "error");
                  } else {
                    setTotalBranches(branchesData.length);
                  }

                  // Fetch total regionals
                  const { data: regionalsData, error: regionalsError } = await supabase
                    .from('regionais')
                    .select('id')
                    .eq('created_by_username', userId);
                  if (regionalsError) {
                    console.error("Erro ao buscar regionais no Supabase:", regionalsError);
                    setError("Erro ao carregar total de regionais.");
                    showToast("Erro ao carregar regionais.", "error");
                  } else {
                    setTotalRegionals(regionalsData.length);
                  }

                  // Fetch total plants
                  const { data: plantsData, error: plantsError } = await supabase
                    .from('usinas')
                    .select('id')
                    .eq('created_by_username', userId);
                  if (plantsError) {
                    console.error("Erro ao buscar usinas no Supabase:", plantsError);
                    setError("Erro ao carregar total de usinas.");
                    showToast("Erro ao carregar usinas.", "error");
                  } else {
                    setTotalPlants(plantsData.length);
                  }

                  // Fetch recent transfers
                  const { data: transfersData, error: transfersError } = await supabase
                    .from('trocasFilial')
                    .select('*')
                    .eq('created_by_username', userId)
                    .order('created_at', { ascending: false })
                    .limit(5); // Get last 5 transfers
                  if (transfersError) {
                      console.error("Erro ao buscar transfer√™ncias recentes:", transfersError);
                      setError("Erro ao carregar transfer√™ncias recentes.");
                      showToast("Erro ao carregar transfer√™ncias recentes.", "error");
                  } else {
                      setRecentTransfers(transfersData);
                  }

                  setIsLoading(false);
                };
                fetchDashboardData();
              }, [userId, showToast]);

              React.useEffect(() => {
                if (!userId) return;

                const fetchRegistros = async () => {
                  setIsLoading(true);
                  let queryBuilder = supabase
                    .from('trocasFilial')
                    .select('*')
                    .eq('created_by_username', userId);

                  // Apply date filter
                  if (startDate && endDate) {
                    queryBuilder = queryBuilder.gte('executionDate', startDate).lte('executionDate', endDate);
                  }

                  // Apply user filter
                  if (selectedUser !== 'Todos os Respons√°veis') {
                    queryBuilder = queryBuilder.eq('created_by_username', selectedUser);
                  }

                  const { data, error: fetchError } = await queryBuilder.order('created_at', { ascending: false });

                  if (fetchError) {
                    console.error("Erro ao buscar dados de altera√ß√£o de placas no Supabase:", fetchError);
                    setError("Erro ao carregar dados de altera√ß√£o de placas. Por favor, recarregue a p√°gina.");
                    showToast("Erro ao carregar registros.", "error");
                  } else {
                    setRegistros(data);
                    setError(null);
                  }
                  setIsLoading(false);
                };
                fetchRegistros();
              }, [userId, startDate, endDate, selectedUser, showToast]);

              const handleApplyFilters = () => {
                // Re-fetching is handled by useEffect when state changes
              };

              const exportToCSV = () => {
                const headers = ["Filial", "Placa Antiga", "Placa Nova", "Data da Altera√ß√£o"];
                const rows = registros.map(registro => [
                  registro.newBranch, // Assuming newBranch is the 'filial' in this context
                  registro.plate, // Assuming plate is the 'placa antiga'
                  registro.plate, // No 'placa nova' in trocasFilial, using plate again for now
                  registro.executionDate
                ]);

                let csvContent = headers.map(header => `"${header}"`).join(";") + "\n";
                rows.forEach(row => {
                  csvContent += row.map(field => `"${field}"`).join(";") + "\n";
                });

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                if (link.download !== undefined) {
                  const url = URL.createObjectURL(blob);
                  link.setAttribute("href", url);
                  link.setAttribute("download", "alteracoes_placa.csv");
                  link.style.visibility = 'hidden';
                  document.body.appendChild(link);
                  link.click();
                  document.body.removeChild(link);
                }
              };

              const filteredRegistros = registros.filter(registro =>
                registro.newBranch.toLowerCase().includes(searchTerm.toLowerCase()) ||
                registro.plate.toLowerCase().includes(searchTerm.toLowerCase()) ||
                registro.executionDate.toLowerCase().includes(searchTerm.toLowerCase())
              );

              // Calculate total equipment for chart
              const totalEquipment = Object.values(equipmentCounts).reduce((sum, count) => sum + count, 0);

              return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                  React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" }, "Dashboard de Equipamentos Ativos"),
                  error && (
                    React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 shadow-md", role: "alert" },
                      React.createElement('strong', { className: "font-bold" }, "Erro:"),
                      React.createElement('span', { className: "block sm:inline" }, " ", error)
                    )
                  ),

                  React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4 border-b pb-2" }, "Vis√£o Geral do Sistema"),
                  React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" },
                      React.createElement('div', { className: "bg-purple-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                        React.createElement('div', { className: "flex items-center" },
                          React.createElement(LucideIcon, { name: "Building", className: "h-8 w-8 text-purple-600 mr-3" }),
                          React.createElement('div', null,
                            React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "Total de Filiais"),
                            React.createElement('p', { className: "text-2xl font-bold text-purple-800" }, isLoading ? '...' : totalBranches)
                          )
                        )
                      ),
                      React.createElement('div', { className: "bg-orange-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                        React.createElement('div', { className: "flex items-center" },
                          React.createElement(LucideIcon, { name: "Users", className: "h-8 w-8 text-orange-600 mr-3" }),
                          React.createElement('div', null,
                            React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "Total de Usu√°rios"),
                            React.createElement('p', { className: "text-2xl font-bold text-orange-800" }, isLoading ? '...' : totalUsers)
                          )
                        )
                      ),
                      React.createElement('div', { className: "bg-pink-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                        React.createElement('div', { className: "flex items-center" },
                          React.createElement(LucideIcon, { name: "MapPin", className: "h-8 w-8 text-pink-600 mr-3" }),
                          React.createElement('div', null,
                            React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "Total de Regionais"),
                            React.createElement('p', { className: "text-2xl font-bold text-pink-800" }, isLoading ? '...' : totalRegionals)
                          )
                        )
                      ),
                      React.createElement('div', { className: "bg-indigo-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                        React.createElement('div', { className: "flex items-center" },
                          React.createElement(LucideIcon, { name: "Factory", className: "h-8 w-8 text-indigo-600 mr-3" }),
                          React.createElement('div', null,
                            React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "Total de Usinas"),
                            React.createElement('p', { className: "text-2xl font-bold text-indigo-800" }, isLoading ? '...' : totalPlants)
                          )
                        )
                      ),
                  ),

                  React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4 border-b pb-2 mt-8" }, "Vis√£o Geral dos Equipamentos"),
                  React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" },
                    React.createElement('div', { className: "bg-blue-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                      React.createElement('div', { className: "flex items-center" },
                        React.createElement(LucideIcon, { name: "Truck", className: "h-8 w-8 text-blue-600 mr-3" }),
                        React.createElement('div', null,
                          React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "BOMBA LAN√áA"),
                          React.createElement('p', { className: "text-2xl font-bold text-blue-800" }, isLoading ? '...' : animatedCounts['BOMBA LAN√áA'])
                        )
                      )
                    ),
                    React.createElement('div', { className: "bg-green-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                      React.createElement('div', { className: "flex items-center" },
                        React.createElement(LucideIcon, { name: "Truck", className: "h-8 w-8 text-green-600 mr-3" }),
                        React.createElement('div', null,
                          React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "BETONEIRA"),
                          React.createElement('p', { className: "text-2xl font-bold text-green-800" }, isLoading ? '...' : animatedCounts['BETONEIRA'])
                        )
                      )
                    ),
                    React.createElement('div', { className: "bg-yellow-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                      React.createElement('div', { className: "flex items-center" },
                        React.createElement(LucideIcon, { name: "Truck", className: "h-8 w-8 text-yellow-600 mr-3" }),
                        React.createElement('div', null,
                          React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "BOMBA"),
                          React.createElement('p', { className: "text-2xl font-bold text-yellow-800" }, isLoading ? '...' : animatedCounts['BOMBA'])
                        )
                      )
                    ),
                  ),

                  React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4 border-b pb-2 mt-8" }, "Distribui√ß√£o de Equipamentos"),
                  React.createElement('div', { className: "mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50" },
                      totalEquipment === 0 ? (
                          React.createElement('p', { className: "text-center text-gray-500" }, isLoading ? "Carregando distribui√ß√£o..." : "Nenhum equipamento para exibir a distribui√ß√£o.")
                      ) : (
                          Object.keys(equipmentCounts).map(type => {
                              const percentage = (equipmentCounts[type] / totalEquipment) * 100;
                              const barColor = type === 'BOMBA LAN√áA' ? 'bg-blue-600' : type === 'BETONEIRA' ? 'bg-green-600' : 'bg-yellow-600';
                              return (
                                  React.createElement('div', { key: type, className: "mb-4" },
                                      React.createElement('div', { className: "flex justify-between mb-1 text-sm font-medium text-gray-700" },
                                          React.createElement('span', null, type),
                                          React.createElement('span', null, `${percentage.toFixed(1)}%`)
                                      ),
                                      React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-2.5" },
                                          React.createElement('div', { className: `${barColor} h-2.5 rounded-full transition-all duration-500 ease-out`, style: { width: `${percentage}%` } })
                                      )
                                  )
                              );
                          })
                      )
                  ),

                  React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4 border-b pb-2 mt-8" }, "Atividades Recentes (Trocas de Filial)"),
                  React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200 mb-8" },
                      isLoading && recentTransfers.length === 0 ? (
                          React.createElement('p', { className: "px-6 py-4 text-sm text-gray-500 text-center" }, "Carregando atividades recentes...")
                      ) : recentTransfers.length === 0 ? (
                          React.createElement('p', { className: "px-6 py-4 text-sm text-gray-500 text-center" }, "Nenhuma troca de filial recente.")
                      ) : (
                          React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                              React.createElement('thead', { className: "bg-gray-100" },
                                  React.createElement('tr', null,
                                      React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa"),
                                      React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Nova Filial"),
                                      React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Data"),
                                      React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Respons√°vel")
                                  )
                              ),
                              React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                  recentTransfers.map((transfer) => (
                                      React.createElement('tr', { key: transfer.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                          React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, transfer.plate),
                                          React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, transfer.newBranch),
                                          React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, transfer.executionDate),
                                          React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, transfer.created_by_username)
                                      )
                                  ))
                              )
                          )
                      )
                  ),


                  React.createElement('div', { className: "mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50" },
                    React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4" }, "Filtrar Registros de Troca de Placas"),
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end" },
                      React.createElement('div', { className: "relative" },
                        React.createElement('label', { htmlFor: "startDate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Data In√≠cio"),
                        React.createElement('div', { className: "flex items-center border border-gray-300 rounded-md shadow-sm" },
                          React.createElement('input', {
                            type: "date",
                            id: "startDate",
                            value: startDate,
                            onChange: (e) => setStartDate(e.target.value),
                            className: "block w-full px-3 py-2 bg-transparent focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                            disabled: isLoading
                          }),
                          React.createElement(LucideIcon, { name: "CalendarDays", className: "h-5 w-5 text-gray-400 mr-2" })
                        )
                      ),
                      React.createElement('div', { className: "relative" },
                        React.createElement('label', { htmlFor: "endDate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Data Fim"),
                        React.createElement('div', { className: "flex items-center border border-gray-300 rounded-md shadow-sm" },
                          React.createElement('input', {
                            type: "date",
                            id: "endDate",
                            value: endDate,
                            onChange: (e) => setEndDate(e.target.value),
                            className: "block w-full px-3 py-2 bg-transparent focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                            disabled: isLoading
                          }),
                          React.createElement(LucideIcon, { name: "CalendarDays", className: "h-5 w-5 text-gray-400 mr-2" })
                        )
                      ),

                      React.createElement('div', { className: "relative" },
                        React.createElement('label', { htmlFor: "responsibleUser", className: "block text-sm font-medium text-gray-700 mb-1" }, "Respons√°vel"),
                        React.createElement('div', { className: "flex items-center border border-gray-300 rounded-md shadow-sm" },
                          React.createElement(LucideIcon, { name: "User", className: "h-5 w-5 text-gray-400 ml-3" }),
                          React.createElement('select', {
                            id: "responsibleUser",
                            value: selectedUser,
                            onChange: (e) => setSelectedUser(e.target.value),
                            className: "block w-full px-3 py-2 bg-transparent focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm appearance-none pr-8 transition duration-150 ease-in-out",
                            disabled: isLoading
                          },
                            availableUsers.map(user => (
                              React.createElement('option', { key: user, value: user }, user)
                            ))
                          ),
                          React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5 text-gray-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none" })
                        )
                      ),

                      React.createElement('div', { className: "md:col-span-3 lg:col-span-1 flex justify-center md:justify-start" },
                        React.createElement('button', {
                          onClick: handleApplyFilters,
                          className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105 w-full md:w-auto",
                          disabled: isLoading
                        },
                          isLoading ? (
                            React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill="none", viewBox="0 0 24 24" },
                              React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r="10", stroke: "currentColor", strokeWidth: "4" }),
                              React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                            )
                          ) : (
                            React.createElement(LucideIcon, { name: "Search", className: "mr-2 h-5 w-5" })
                          ),
                          isLoading ? 'Aplicando...' : 'Aplicar Filtros'
                        )
                      )
                    )
                  ),

                  React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4 border-b pb-2 mt-8" }, "Registros de Altera√ß√£o de Placas"),
                  React.createElement('div', { className: "flex justify-between items-center mb-4" },
                    React.createElement('div', { className: "relative flex-grow mr-4" },
                      React.createElement('input', {
                        type: "text",
                        placeholder: "Buscar registros...",
                        value: searchTerm,
                        onChange: (e) => setSearchTerm(e.target.value),
                        className: "block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                        disabled: isLoading
                      }),
                      React.createElement('div', { className: "absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none" },
                        React.createElement(LucideIcon, { name: "Search", className: "h-5 w-5 text-gray-400" })
                      )
                    ),
                    React.createElement('button', {
                      onClick: exportToCSV,
                      className: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out transform hover:scale-105",
                      disabled: isLoading
                    },
                      React.createElement(LucideIcon, { name: "FileText", className: "mr-2 h-5 w-5" }),
                      "Exportar CSV"
                    )
                  ),

                  React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                    React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                      React.createElement('thead', { className: "bg-gray-100" },
                        React.createElement('tr', null,
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filial"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa Antiga"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa Nova"),
                          React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Data Altera√ß√£o")
                        )
                      ),
                      React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                        isLoading && filteredRegistros.length === 0 ? (
                            React.createElement('tr', null,
                                React.createElement('td', { colSpan: "4", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Carregando registros...")
                            )
                        ) : filteredRegistros.length === 0 ? (
                          React.createElement('tr', null,
                            React.createElement('td', { colSpan: "4", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhum registro encontrado.")
                          )
                        ) : (
                          filteredRegistros.map((registro) => (
                            React.createElement('tr', { key: registro.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, registro.newBranch),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, registro.plate),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, registro.plate),
                              React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, registro.executionDate)
                            )
                          ))
                        )
                      )
                    )
                  )
                )
              );
            }

            // Componente para a tela vazia inicial (agora com visual e a descri√ß√£o)
            function EmptyPanel() {
              return (
                React.createElement('div', { className: "flex flex-col items-center justify-center min-h-[calc(100vh-16rem)] bg-white p-6 rounded-xl shadow-lg text-center" },
                  // Removed LucideIcon for 'Building' again
                  React.createElement('h2', { className: "text-4xl font-extrabold text-blue-600 text-center mb-4" }, "SISTEMA DE GERENCIAMENTO"),
                  React.createElement('p', { className: "text-lg text-gray-700 mt-4 max-w-2xl leading-relaxed" }, "O SISTEMA DE GERENCIAMENTO √© um aplicativo desenvolvido para controlar de forma pr√°tica e eficiente a troca de placas entre usinas. Ele permite registrar, rastrear e organizar as movimenta√ß√µes de forma centralizada, garantindo agilidade e seguran√ßa nas opera√ß√µes.")
                )
              );
            }


            // Componente principal da Aplica√ß√£o
            function App() {
              const [userId, setUserId] = React.useState(null); // This will now store the username
              const [userRole, setUserRole] = React.useState(null);
              const [isAuthReady, setIsAuthReady] = React.useState(false);
              const [currentPage, setCurrentPage] = React.useState('emptyPanel');
              const [isSidebarOpen, setIsSidebarOpen] = React.useState(false);
              const [isCadastroOpen, setIsCadastroOpen] = React.useState(false);
              const [isOperacionalOpen, setIsOperacionalOpen] = React.useState(false);
              const [error, setError] = React.useState(null);
              const [toastMessage, setToastMessage] = React.useState(null);
              const [toastType, setToastType] = React.useState(null);

              const showToast = (message, type) => {
                  setToastMessage(message);
                  setToastType(type);
              };

              const clearToast = () => {
                  setToastMessage(null);
                  setToastType(null);
              };


              // Simulate Firebase Auth state for React Context
              React.useEffect(() => {
                // In a real Supabase app, you would use supabase.auth.onAuthStateChange
                // For this direct HTML conversion, we assume authentication happens via LoginPage
                // and userId/userRole are set directly by onLogin.
                // We set isAuthReady to true immediately to allow LoginPage to render.
                setIsAuthReady(true);
              }, []);

              const handleLogin = (role, username) => {
                setUserRole(role);
                setUserId(username); // Set userId to the logged-in username for data partitioning
                setCurrentPage('emptyPanel');
                showToast("Login realizado com sucesso!", "success");
              };

              const handleLogout = () => {
                // In a real Supabase app, you would call supabase.auth.signOut() here
                setUserRole(null);
                setUserId(null);
                setCurrentPage('login');
                showToast("Sess√£o encerrada.", "success");
              };

              const toggleSidebar = () => {
                setIsSidebarOpen(!isSidebarOpen);
              };

              const closeSidebar = () => {
                setIsSidebarOpen(false);
              };

              const toggleCadastro = () => {
                setIsCadastroOpen(!isCadastroOpen);
              };

              const toggleOperacional = () => {
                setIsOperacionalOpen(!isOperacionalOpen);
              };

              if (!isAuthReady) {
                return (
                  React.createElement('div', { className: "flex items-center justify-center min-h-screen bg-gray-100" },
                    React.createElement('div', { className: "text-lg font-semibold text-gray-700" }, "Carregando aplicativo...")
                  )
                );
              }

              if (!userRole) {
                return React.createElement(LoginPage, { onLogin: handleLogin });
              }

              return (
                React.createElement('div', { className: "min-h-screen bg-gray-100 font-sans flex" },
                  React.createElement('div', {
                    className: `fixed inset-y-0 left-0 bg-gray-800 text-white w-64 p-4 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} transition-transform duration-300 ease-in-out z-50 rounded-r-xl shadow-lg`
                  },
                    React.createElement('div', { className: "flex items-center justify-between mb-8" },
                      React.createElement('h2', { className: "text-2xl font-bold" }, "Menu"),
                      React.createElement('button', { className: "text-white p-1 rounded-full hover:bg-gray-700 transition-colors", onClick: toggleSidebar },
                        React.createElement(LucideIcon, { name: "X", className: "h-6 w-6" })
                      )
                    ),
                    React.createElement('nav', null,
                      React.createElement('ul', null,
                        React.createElement('li', { className: "mb-2" },
                          React.createElement('button', {
                            onClick: () => { setCurrentPage('dashboard'); closeSidebar(); },
                            className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'dashboard' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-200'}`
                          },
                            React.createElement(LucideIcon, { name: "LayoutDashboard", className: "mr-3 h-5 w-5" }),
                            "Dashboard"
                          )
                        ),
                        React.createElement('li', { className: "mb-2" },
                          React.createElement('button', {
                            onClick: toggleOperacional,
                            className: `flex items-center justify-between w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${isOperacionalOpen ? 'bg-gray-700 text-white shadow-md' : 'hover:bg-gray-700 text-gray-200'}`
                          },
                            React.createElement('span', { className: "flex items-center" },
                              React.createElement(LucideIcon, { name: "Settings", className: "mr-3 h-5 w-5" }),
                              "Operacional"
                            ),
                            isOperacionalOpen ? React.createElement(LucideIcon, { name: "ChevronUp", className: "h-5 w-5" }) : React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5" })
                          ),
                          isOperacionalOpen && (
                            React.createElement('ul', { className: "ml-6 mt-2 space-y-2" },
                              React.createElement('li', null,
                                React.createElement('button', {
                                  onClick: () => { setCurrentPage('branchTransfer'); closeSidebar(); },
                                  className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'branchTransfer' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                },
                                  React.createElement(LucideIcon, { name: "ArrowLeftRight", className: "mr-3 h-5 w-5" }),
                                  "Troca de Filial"
                                )
                              )
                            )
                          )
                        ),
                        userRole === 'administrador' && (
                          React.createElement('li', { className: "mb-2" },
                            React.createElement('button', {
                              onClick: toggleCadastro,
                              className: `flex items-center justify-between w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${isCadastroOpen ? 'bg-gray-700 text-white shadow-md' : 'hover:bg-gray-700 text-gray-200'}`
                            },
                              React.createElement('span', { className: "flex items-center" },
                                React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-3 h-5 w-5" }),
                                "Cadastro"
                              ),
                              isCadastroOpen ? React.createElement(LucideIcon, { name: "ChevronUp", className: "h-5 w-5" }) : React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5" })
                            ),
                            isCadastroOpen && (
                              React.createElement('ul', { className: "ml-6 mt-2 space-y-2" },
                                React.createElement('li', null,
                                  React.createElement('button', {
                                    onClick: () => { setCurrentPage('branchManagement'); closeSidebar(); },
                                    className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'branchManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                  },
                                    React.createElement(LucideIcon, { name: "Building", className: "mr-3 h-5 w-5" }),
                                    "Filiais"
                                  )
                                ),
                                React.createElement('li', null,
                                  React.createElement('button', {
                                    onClick: () => { setCurrentPage('equipmentManagement'); closeSidebar(); },
                                    className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'equipmentManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                  },
                                    React.createElement(LucideIcon, { name: "Truck", className: "mr-3 h-5 w-5" }),
                                    "Equipamentos"
                                )
                                ),
                                React.createElement('li', { className: "mb-2" },
                                  React.createElement('button', {
                                    onClick: () => { setCurrentPage('userManagement'); closeSidebar(); },
                                    className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'userManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                  },
                                    React.createElement(LucideIcon, { name: "Users", className: "mr-3 h-5 w-5" }),
                                    "Usu√°rios"
                                  )
                                ),
                                React.createElement('li', { className: "mb-2" },
                                  React.createElement('button', {
                                    onClick: () => { setCurrentPage('regionalManagement'); closeSidebar(); }, // New menu item
                                    className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'regionalManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                  },
                                    React.createElement(LucideIcon, { name: "MapPin", className: "mr-3 h-5 w-5" }), // New icon
                                    "Regionais"
                                  )
                                ),
                                React.createElement('li', { className: "mb-2" },
                                  React.createElement('button', {
                                    onClick: () => { setCurrentPage('plantManagement'); closeSidebar(); }, // New menu item for Usinas
                                    className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'plantManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                  },
                                    React.createElement(LucideIcon, { name: "Factory", className: "mr-3 h-5 w-5" }), // New icon for Usinas
                                    "Usinas"
                                  )
                                )
                              )
                            )
                          )
                        ),
                        React.createElement('li', { className: "mt-8" },
                          React.createElement('button', {
                            onClick: handleLogout,
                            className: "flex items-center w-full px-4 py-2 rounded-lg text-red-400 hover:bg-gray-700 transition duration-150 ease-in-out"
                          },
                            React.createElement(LucideIcon, { name: "LogOut", className: "mr-3 h-5 w-5" }),
                            "Sair"
                          )
                        )
                      )
                    )
                  ),

                  isSidebarOpen && (
                    React.createElement('div', {
                      className: "fixed inset-0 bg-black opacity-50 z-40",
                      onClick: closeSidebar
                    })
                  ),

                  React.createElement('div', { className: "flex-1 p-4 flex flex-col items-center" },
                    React.createElement('header', { className: "w-full max-w-full bg-white p-4 rounded-xl shadow-lg mb-8 flex justify-between items-center" },
                      React.createElement('button', { className: "text-gray-700 p-2 rounded-full hover:bg-gray-100 transition-colors", onClick: toggleSidebar },
                        React.createElement(LucideIcon, { name: "Menu", className: "h-6 w-6" })
                      ),
                      React.createElement('h1', { className: "text-4xl font-extrabold text-blue-600 text-center flex-grow" }, "TERC SISTEMAS")
                    ),

                    error && (
                      React.createElement('div', { className: "max-w-full w-full bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 shadow-md", role: "alert" },
                        React.createElement('strong', { className: "font-bold" }, "Erro:"),
                        React.createElement('span', { className: "block sm:inline" }, " ", error)
                      )
                    ),

                    React.createElement('div', { className: "max-w-full w-full" },
                      currentPage === 'emptyPanel' && React.createElement(EmptyPanel, null),
                      currentPage === 'dashboard' && React.createElement(Dashboard, { userId: userId, showToast: showToast }),
                      currentPage === 'branchManagement' && userRole === 'administrador' && React.createElement(BranchManagement, { userId: userId, showToast: showToast }),
                      currentPage === 'equipmentManagement' && userRole === 'administrador' && React.createElement(EquipmentManagement, { userId: userId, showToast: showToast }),
                      currentPage === 'userManagement' && userRole === 'administrador' && React.createElement(UserManagement, { userId: userId, showToast: showToast }),
                      currentPage === 'regionalManagement' && userRole === 'administrador' && React.createElement(RegionalManagement, { userId: userId, showToast: showToast }),
                      currentPage === 'plantManagement' && userRole === 'administrador' && React.createElement(PlantManagement, { userId: userId, showToast: showToast }), // Render new component
                      currentPage === 'branchTransfer' && React.createElement(BranchTransfer, { userId: userId, setCurrentPage: setCurrentPage, showToast: showToast })
                    ),
                    toastMessage && React.createElement(Toast, { message: toastMessage, type: toastType, onClose: clearToast })
                  )
                )
              );
            }

            // ReactDOM.render(React.createElement(App, null), document.getElementById('root')); // This will be called after Supabase loads
        }; // End of window.onload
    </script>
</body>
</html>
