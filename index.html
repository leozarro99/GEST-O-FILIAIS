<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placa App supabase</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Slightly darker background for a professional feel */
        }
        /* Custom styles for select arrow */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: none; /* Remove default arrow */
        }
        select::-ms-expand {
            display: none; /* Hide arrow in IE/Edge */
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Animations for modals and toasts */
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scale-in {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.2s ease-out forwards;
        }
        .animate-scale-in {
            animation: scale-in 0.3s ease-out forwards;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- supabase CDN -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // Substitua com a URL do seu projeto supabase e a chave anon
        const supabaseUrl = 'https://gfivmnnysomfwrffybeh.supabase.co'; // Ex: 'https://abcdefg.supabase.co'
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmaXZtbm55c29tZndyZmZ5YmVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyOTY3NjgsImV4cCI6MjA2ODg3Mjc2OH0.NxetXJoCLh4q9zAqn_olimziI3YP4MAJzB8ed4qf8cg'; // SUA CHAVE ANON PUBLIC DO supabase.

        const supabase = createClient(supabaseUrl, supabaseAnonKey);

        // Helper function to generate Lucide icons
        const icons = {
            FileText: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L15 2z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>',
            PlusCircle: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>',
            Search: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',
            Building: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M12 18h.01"/></svg>',
            Truck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-truck"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M19 18h2a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-1V6a2 2 0 0 0-2-2h-3a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/></svg>',
            UserCheck: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="22 7 18 11 16 9"/></svg>',
            LogOut: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 16 22 12 17 8"/><line x1="22" x2="11" y1="12" y2="12"/></svg>',
            Trash2: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>',
            Menu: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>',
            X: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',
            ChevronDown: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>',
            ChevronUp: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-up"><path d="m18 15-6-6-6 6"/></svg>',
            LayoutDashboard: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>',
            CalendarDays: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>',
            User: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
            Users: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
            Settings: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.28a2 2 0 0 0 .73 2.73l.04.02a2 2 0 0 1 .97 1.95v.44a2 2 0 0 1-.97 1.95l-.04.02a2 2 0 0 0-.73 2.73l.78 1.28a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.28a2 2 0 0 0-.73-2.73l-.04-.02a2 2 0 0 1-.97-1.95v-.44a2 2 0 0 1 .97-1.95l.04-.02a2 2 0 0 0 .73-2.73l-.78-1.28a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>',
            ArrowLeftRight: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-arrow-left-right"><path d="M8 3L4 7L8 11"/><path d="M4 7h16"/><path d="M16 21l4-4l-4-4"/><path d="M20 17H4"/></svg>',
            ArrowLeft: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>',
            MapPin: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M12 18.3a3.3 3.3 0 1 0 0-6.6 3.3 3.3 0 0 0 0 6.6z"/><path d="M12 2C7.58 2 4 5.58 4 10c0 5.57 8 12 8 12s8-6.43 8-12c0-4.42-3.58-8-8-8z"/></svg>',
            Factory: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-factory"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 9.86 2H7.14a2 2 0 0 0-1.66.9l-.82 1.2A2 2 0 0 1 4 6H2v14z"/><path d="M10 10v4"/><path d="M14 10v4"/><path d="M18 10v4"/><path d="M6 10v4"/></svg>'
        };

        // LucideIcon component, memoized for performance
        const LucideIcon = React.memo(function LucideIcon({ name, className }) {
            return React.createElement('span', {
                className: className,
                dangerouslySetInnerHTML: { __html: icons[name] || '' }
            });
        });

        // Toast component, memoized for performance
        const Toast = React.memo(function Toast({ message, type, onClose }) {
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? '✔' : '✖';

            React.useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 3000);
                return () => clearTimeout(timer);
            }, [onClose]); // Dependency array includes onClose

            return (
                React.createElement('div', { className: `fixed bottom-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg flex items-center space-x-2 z-50 transition-all duration-300 ease-in-out transform translate-y-0 opacity-100` },
                    React.createElement('span', { className: "font-bold text-xl" }, icon),
                    React.createElement('p', null, message),
                    React.createElement('button', { onClick: onClose, className: "ml-4 font-bold opacity-75 hover:opacity-100 transition-opacity" }, 'X')
                )
            );
        });

        // ConfirmationModal component, memoized for performance
        const ConfirmationModal = React.memo(function ConfirmationModal({ message, onConfirm, onCancel }) {
            return (
                React.createElement('div', { className: "fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 animate-fade-in" },
                    React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-2xl max-w-sm w-full text-center transform scale-95 animate-scale-in" },
                        React.createElement('p', { className: "text-lg font-semibold text-gray-800 mb-6" }, message),
                        React.createElement('div', { className: "flex justify-center space-x-4" },
                            React.createElement('button', {
                                onClick: onConfirm,
                                className: "px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Confirmar"),
                            React.createElement('button', {
                                onClick: onCancel,
                                className: "px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                            }, "Cancelar")
                        )
                    )
                )
            );
        });

        // supabase Service Utility
        const SupabaseService = {
            // Authenticate user with email and password
            signIn: async (email, password) => {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) throw error;
                return data.user;
            },

            // Sign up a new user
            signUp: async (email, password) => {
                const { data, error } = await supabase.auth.signUp({ email, password });
                if (error) throw error;
                return data.user;
            },

            // Sign out user
            signOut: async () => {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
            },

            // Get current user's session
            getSession: async () => {
                const { data: { session }, error } = await supabase.auth.getSession();
                if (error) throw error;
                return session;
            },

            // Get current user's ID
            getCurrentUserId: () => {
                const user = supabase.auth.currentUser;
                return user ? user.id : null;
            },

            // Get user role from app_users table
            getUserRole: async (username) => {
                try {
                    const { data, error } = await supabase
                        .from('app_users')
                        .select('role')
                        .eq('username', username)
                        .limit(1);

                    if (error) throw error;
                    if (data && data.length > 0) {
                        return data[0].role;
                    }
                    return null; // User not found or no role
                } catch (error) {
                    console.error("Erro ao buscar função do utilizador no supabase:", error);
                    throw error;
                }
            },

            // Generic function to listen to a table
            listenToTable: (tableName, callback, filter = {}) => {
                const subscription = supabase
                    .from(tableName)
                    .on('*', payload => {
                        // For simplicity, refetch all data on any change
                        // In a more complex app, you might parse payload.new, payload.old, payload.eventType
                        SupabaseService.getDocuments(tableName, filter)
                            .then(callback)
                            .catch(error => console.error(`Erro ao atualizar dados da tabela ${tableName}:`, error));
                    })
                    .subscribe();

                // Initial fetch
                SupabaseService.getDocuments(tableName, filter)
                    .then(callback)
                    .catch(error => console.error(`Erro ao buscar dados iniciais da tabela ${tableName}:`, error));

                return () => {
                    supabase.removeSubscription(subscription);
                };
            },

            // Generic function to add a document (row)
            addDocument: async (tableName, data) => {
                const { error } = await supabase
                    .from(tableName)
                    .insert([data]);
                if (error) throw error;
            },

            // Generic function to delete a document (row)
            deleteDocument: async (tableName, docId) => {
                const { error } = await supabase
                    .from(tableName)
                    .delete()
                    .eq('id', docId);
                if (error) throw error;
            },

            // Generic function to get documents once (not real-time)
            getDocuments: async (tableName, filters = []) => {
                let query = supabase.from(tableName).select('*');

                filters.forEach(filter => {
                    query = query.eq(filter.field, filter.value);
                });

                const { data, error } = await query;
                if (error) throw error;
                return data;
            }
        };

        // Componente para a tela de Login, memoized
        const LoginPage = React.memo(function LoginPage({ onLogin }) {
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [error, setError] = React.useState('');
            const [isLoggingIn, setIsLoggingIn] = React.useState(false);

            const handleLogin = React.useCallback(async (e) => {
                e.preventDefault();
                setIsLoggingIn(true);
                setError('');

                if (!email || !password) {
                    setError('Por favor, insira o seu e-mail e senha.');
                    setIsLoggingIn(false);
                    return;
                }

                try {
                    // Special login for 'admin' user with fixed password
                    if (email.toLowerCase() === 'admin@tercsistemas.com' && password === '1234') {
                        // In a real app, you'd have a dedicated admin login or role check after supabase auth
                        // For this example, we'll simulate an admin login
                        const { data: { user }, error: signInError } = await supabase.auth.signInWithPassword({ email: 'admin@tercsistemas.com', password: '1234' });
                        if (signInError) throw signInError;
                        onLogin('administrador', 'admin'); // Pass a fixed username for admin
                    } else {
                        const { data: { user }, error: signInError } = await supabase.auth.signInWithPassword({ email, password });
                        if (signInError) throw signInError;

                        // After successful supabase auth, fetch the user's role from the 'app_users' table
                        const users = await SupabaseService.getDocuments('app_users', [{ field: 'username', operator: '==', value: email.toLowerCase() }]);
                        if (users && users.length > 0) {
                            onLogin(users[0].role, users[0].username);
                        } else {
                            setError('Utilizador não encontrado ou sem função definida. Por favor, registe-se.');
                            await SupabaseService.signOut(); // Sign out if user not in app_users
                        }
                    }
                } catch (e) {
                    console.error("Erro de autenticação supabase:", e);
                    setError(e.message || "Erro ao autenticar. Por favor, tente novamente.");
                } finally {
                    setIsLoggingIn(false);
                }
            }, [email, password, onLogin]); // Dependencies for useCallback

            const handleSignUp = React.useCallback(async (e) => {
                e.preventDefault();
                setIsLoggingIn(true);
                setError('');

                if (!email || !password) {
                    setError('Por favor, insira o seu e-mail e senha para se registar.');
                    setIsLoggingIn(false);
                    return;
                }

                try {
                    const { data, error: signUpError } = await supabase.auth.signUp({ email, password });
                    if (signUpError) throw signUpError;

                    // After successful supabase auth, add user to 'app_users' table with default role 'usuario'
                    await SupabaseService.addDocument('app_users', { username: email.toLowerCase(), password: password, role: 'usuario' }); // IMPORTANT: Hash passwords in production!
                    onLogin('usuario', email.toLowerCase());
                } catch (e) {
                    console.error("Erro de registo supabase:", e);
                    setError(e.message || "Erro ao registar. Por favor, tente novamente.");
                } finally {
                    setIsLoggingIn(false);
                }
            }, [email, password, onLogin]);

            return (
                React.createElement('div', { className: "flex items-center justify-center min-h-screen bg-gray-100 font-sans" },
                    React.createElement('div', { className: "bg-white p-8 rounded-xl shadow-lg w-full max-w-md" },
                        React.createElement('div', { className: "flex flex-col items-center justify-center mb-6" },
                            React.createElement('h2', { className: "text-4xl font-extrabold text-blue-600 text-center" }, "TERC SISTEMAS")
                        ),
                        error && (
                            React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                                React.createElement('strong', { className: "font-bold" }, "Erro:"),
                                React.createElement('span', { className: "block sm:inline" }, " ", error)
                            )
                        ),
                        React.createElement('form', { onSubmit: handleLogin },
                            React.createElement('div', { className: "mb-4" },
                                React.createElement('label', { htmlFor: "email", className: "block text-sm font-medium text-gray-700 mb-1" }, "E-mail"),
                                React.createElement('input', {
                                    type: "email",
                                    id: "email",
                                    value: email,
                                    onChange: (e) => { setEmail(e.target.value); setError(''); },
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    placeholder: "Digite o seu e-mail",
                                    required: true,
                                    disabled: isLoggingIn
                                })
                            ),
                            React.createElement('div', { className: "mb-6" },
                                React.createElement('label', { htmlFor: "password", className: "block text-sm font-medium text-gray-700 mb-1" }, "Senha"),
                                React.createElement('input', {
                                    type: "password",
                                    id: "password",
                                    value: password,
                                    onChange: (e) => setPassword(e.target.value),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    placeholder: "Digite a sua senha",
                                    required: true,
                                    disabled: isLoggingIn
                                })
                            ),
                            React.createElement('button', {
                                type: "submit",
                                className: "w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105 mb-3",
                                disabled: isLoggingIn
                            },
                                isLoggingIn ? (
                                    React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                        React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                        React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                )
                            ) : (
                                React.createElement(LucideIcon, { name: "UserCheck", className: "mr-2 h-5 w-5" })
                                ),
                                isLoggingIn ? 'A entrar...' : 'Entrar'
                            ),
                            React.createElement('button', {
                                type: "button",
                                onClick: handleSignUp,
                                className: "w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-blue-600 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                disabled: isLoggingIn
                            },
                                isLoggingIn ? 'A registar...' : 'Registar'
                            )
                        )
                    )
                )
            );
        });

        // Componente para Gerenciamento de Filiais, memoized
        const BranchManagement = React.memo(function BranchManagement({ userId, showToast }) {
            const [newBranchName, setNewBranchName] = React.useState('');
            const [branches, setBranches] = React.useState([]);
            const [error, setError] = React.useState(null);
            const [isLoading, setIsLoading] = React.useState(false);
            const [showConfirmModal, setShowConfirmModal] = React.useState(false);
            const [branchToDelete, setBranchToDelete] = React.useState(null);

            // Fetch branches in real-time using supabase subscriptions
            React.useEffect(() => {
                if (!userId) return;
                setIsLoading(true);
                const unsubscribe = SupabaseService.listenToTable('filiais', (data) => {
                    const sortedData = data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    setBranches(sortedData);
                    setError(null);
                    setIsLoading(false);
                }, [{ field: 'created_by_username', value: userId }]); // Filter by current user's ID
                return () => unsubscribe(); // Cleanup listener on component unmount
            }, [userId]); // Dependency array includes userId

            const handleAddBranch = React.useCallback(async (e) => {
                e.preventDefault();
                if (!newBranchName.trim()) {
                    setError("O nome da filial não pode estar vazio.");
                    showToast("O nome da filial não pode estar vazio.", "error");
                    return;
                }
                setIsLoading(true);
                try {
                    await SupabaseService.addDocument('filiais', { name: newBranchName.trim(), created_by_username: userId });
                    setNewBranchName('');
                    setError(null);
                    showToast("Filial adicionada com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao adicionar filial:", e);
                    setError("Erro ao adicionar filial. Tente novamente.");
                    showToast("Erro ao adicionar filial.", "error");
                } finally {
                    setIsLoading(false);
                }
            }, [newBranchName, userId, showToast]); // Dependencies for useCallback

            const confirmDeleteBranch = React.useCallback((branch) => {
                setBranchToDelete(branch);
                setShowConfirmModal(true);
            }, []); // No dependencies for useCallback, as it just sets state

            const handleDeleteBranch = React.useCallback(async () => {
                if (!branchToDelete) return;

                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                    await SupabaseService.deleteDocument('filiais', branchToDelete.id);
                    showToast("Filial eliminada com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao eliminar filial:", e);
                    setError("Erro ao eliminar filial. Tente novamente.");
                    showToast("Erro ao eliminar filial.", "error");
                } finally {
                    setIsLoading(false);
                    setBranchToDelete(null);
                }
            }, [branchToDelete, showToast]); // Dependencies for useCallback

            return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Filiais"),
                    error && (
                        React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                            React.createElement('strong', { className: "font-bold" }, "Erro:"),
                            React.createElement('span', { className: "block sm:inline" }, " ", error)
                        )
                    ),
                    React.createElement('form', { onSubmit: handleAddBranch, className: "flex flex-col sm:flex-row gap-4 mb-6" },
                        React.createElement('input', {
                            type: "text",
                            value: newBranchName,
                            onChange: (e) => setNewBranchName(e.target.value),
                            className: "flex-grow mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                            placeholder: "Nome da nova filial",
                            required: true,
                            disabled: isLoading
                        }),
                        React.createElement('button', {
                            type: "submit",
                            className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                            disabled: isLoading
                        },
                            isLoading ? (
                                React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                    React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                    React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                )
                            ) : (
                                React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-2 h-5 w-5" })
                            ),
                            isLoading ? 'A adicionar...' : 'Adicionar Filial'
                        )
                    ),
                    React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                        React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                            React.createElement('thead', { className: "bg-gray-100" },
                                React.createElement('tr', null,
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filial"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Ações")
                                )
                            ),
                            React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                isLoading && branches.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "2", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "A carregar filiais...")
                                    )
                                ) : branches.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "2", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhuma filial registada.")
                                    )
                                ) : (
                                    branches.map((branch) => (
                                        React.createElement('tr', { key: branch.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, branch.name),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                React.createElement('button', {
                                                    onClick: () => confirmDeleteBranch(branch),
                                                    className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150",
                                                    title: "Eliminar Filial",
                                                    disabled: isLoading
                                                },
                                                    React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                                )
                                            )
                                        )
                                    ))
                                )
                            )
                        )
                    ),
                    showConfirmModal && React.createElement(ConfirmationModal, {
                        message: `Tem a certeza que deseja eliminar a filial "${branchToDelete?.name}"?`,
                        onConfirm: handleDeleteBranch,
                        onCancel: React.useCallback(() => setShowConfirmModal(false), []) // Memoize inline function
                    })
                )
            );
        });

        // Componente para Gerenciamento de Equipamentos, memoized
        const EquipmentManagement = React.memo(function EquipmentManagement({ userId, showToast }) {
            const [newPlate, setNewPlate] = React.useState('');
            const [newEquipmentType, setNewEquipmentType] = React.useState('');
            const [equipmentList, setEquipmentList] = React.useState([]);
            const [error, setError] = React.useState(null);
            const [isLoading, setIsLoading] = React.useState(false);
            const [showConfirmModal, setShowConfirmModal] = React.useState(false);
            const [equipmentToDelete, setEquipmentToDelete] = React.useState(null);

            const equipmentTypes = ["BOMBA LANÇA", "BOMBA", "BETONEIRA"];

            // Fetch equipment in real-time using supabase subscriptions
            React.useEffect(() => {
                if (!userId) return;
                setIsLoading(true);
                const unsubscribe = SupabaseService.listenToTable('equipamentos', (data) => {
                    const sortedData = data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    setEquipmentList(sortedData);
                    setError(null);
                    setIsLoading(false);
                }, [{ field: 'created_by_username', value: userId }]); // Filter by current user's ID
                return () => unsubscribe(); // Cleanup listener on component unmount
            }, [userId]); // Dependency array includes userId

            const handleAddEquipment = React.useCallback(async (e) => {
                e.preventDefault();
                if (!newPlate.trim() || !newEquipmentType) {
                    setError("Por favor, preencha a placa e selecione o tipo de equipamento.");
                    showToast("Preencha todos os campos.", "error");
                    return;
                }
                setIsLoading(true);
                try {
                    await SupabaseService.addDocument('equipamentos', { plate: newPlate.trim(), type: newEquipmentType, created_by_username: userId });
                    setNewPlate('');
                    setNewEquipmentType('');
                    setError(null);
                    showToast("Equipamento adicionado com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao adicionar equipamento:", e);
                    setError("Erro ao adicionar equipamento. Tente novamente.");
                    showToast("Erro ao adicionar equipamento.", "error");
                } finally {
                    setIsLoading(false);
                }
            }, [newPlate, newEquipmentType, userId, showToast]); // Dependencies for useCallback

            const confirmDeleteEquipment = React.useCallback((equipment) => {
                setEquipmentToDelete(equipment);
                setShowConfirmModal(true);
            }, []); // No dependencies for useCallback

            const handleDeleteEquipment = React.useCallback(async () => {
                if (!equipmentToDelete) return;

                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                    await SupabaseService.deleteDocument('equipamentos', equipmentToDelete.id);
                    showToast("Equipamento eliminado com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao eliminar equipamento:", e);
                    setError("Erro ao eliminar equipamento. Tente novamente.");
                    showToast("Erro ao eliminar equipamento.", "error");
                } finally {
                    setIsLoading(false);
                    setEquipmentToDelete(null);
                }
            }, [equipmentToDelete, showToast]); // Dependencies for useCallback

            return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Equipamentos"),
                    error && (
                        React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                            React.createElement('strong', { className: "font-bold" }, "Erro:"),
                            React.createElement('span', { className: "block sm:inline" }, " ", error)
                        )
                    ),
                    React.createElement('form', { onSubmit: handleAddEquipment, className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" },
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "newPlate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Placa"),
                            React.createElement('input', {
                                type: "text",
                                id: "newPlate",
                                value: newPlate,
                                onChange: (e) => setNewPlate(e.target.value),
                                className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                placeholder: "Ex: ABC-1234",
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "newEquipmentType", className: "block text-sm font-medium text-gray-700 mb-1" }, "Tipo de Equipamento"),
                            React.createElement('select', {
                                id: "newEquipmentType",
                                value: newEquipmentType,
                                onChange: (e) => setNewEquipmentType(e.target.value),
                                className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                required: true,
                                disabled: isLoading
                            },
                                React.createElement('option', { value: "" }, "Selecione um tipo"),
                                equipmentTypes.map((type) => (
                                    React.createElement('option', { key: type, value: type }, type)
                                ))
                            )
                        ),
                        React.createElement('div', { className: "md:col-span-2 flex justify-center" },
                            React.createElement('button', {
                                type: "submit",
                                className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                disabled: isLoading
                            },
                                isLoading ? (
                                    React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                        React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                        React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                )
                            ) : (
                                React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-2 h-5 w-5" })
                            ),
                            isLoading ? 'A adicionar...' : 'Adicionar Equipamento'
                        )
                    ),
                    React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                        React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                            React.createElement('thead', { className: "bg-gray-100" },
                                React.createElement('tr', null,
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Tipo"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Ações")
                                )
                            ),
                            React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                isLoading && equipmentList.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "A carregar equipamentos...")
                                    )
                                ) : equipmentList.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhum equipamento registado.")
                                    )
                                ) : (
                                    equipmentList.map((equipment) => (
                                        React.createElement('tr', { key: equipment.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, equipment.plate),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, equipment.type),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                React.createElement('button', {
                                                    onClick: () => confirmDeleteEquipment(equipment),
                                                    className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150",
                                                    title: "Eliminar Equipamento",
                                                    disabled: isLoading
                                                },
                                                    React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                                )
                                            )
                                        )
                                    ))
                                )
                            )
                        )
                    ),
                    showConfirmModal && React.createElement(ConfirmationModal, {
                        message: `Tem a certeza que deseja eliminar o equipamento de placa "${equipmentToDelete?.plate}"?`,
                        onConfirm: handleDeleteEquipment,
                        onCancel: React.useCallback(() => setShowConfirmModal(false), []) // Memoize inline function

        // Novo Componente: Gerenciamento de Utilizadores, memoized
        const UserManagement = React.memo(function UserManagement({ userId, showToast }) {
            const [newUsername, setNewUsername] = React.useState('');
            const [newPassword, setNewPassword] = React.useState('');
            const [newUserRole, setNewUserRole] = React.useState('usuario');
            const [usersList, setUsersList] = React.useState([]);
            const [error, setError] = React.useState(null);
            const [isLoading, setIsLoading] = React.useState(false);
            const [showConfirmModal, setShowConfirmModal] = React.useState(false);
            const [userToDelete, setUserToDelete] = React.useState(null);

            const roles = ['administrador', 'supervisor', 'usuario'];

            // Fetch users in real-time using supabase subscriptions (public table)
            React.useEffect(() => {
                if (!userId) return;
                setIsLoading(true);
                const unsubscribe = SupabaseService.listenToTable('app_users', (data) => {
                    const sortedData = data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    setUsersList(sortedData);
                    setError(null);
                    setIsLoading(false);
                }); // No filter needed for public table
                return () => unsubscribe(); // Cleanup listener on component unmount
            }, [userId]); // Dependency array includes userId

            const handleAddUser = React.useCallback(async (e) => {
                e.preventDefault();
                if (!newUsername.trim() || !newPassword.trim()) {
                    setError("Por favor, preencha o nome de utilizador e a senha.");
                    showToast("Preencha o nome de utilizador e a senha.", "error");
                    return;
                }
                setIsLoading(true);
                try {
                    // Register user with supabase Auth
                    const { data: authData, error: authError } = await supabase.auth.signUp({
                        email: newUsername.trim(), // Using username as email for supabase Auth
                        password: newPassword
                    });
                    if (authError) throw authError;

                    // Add user details to 'app_users' table
                    await SupabaseService.addDocument('app_users', {
                        id: authData.user.id, // Use supabase Auth UID as primary key for app_users
                        username: newUsername.trim(),
                        password: newPassword, // IMPORTANT: Hash passwords in production!
                        role: newUserRole
                    });
                    setNewUsername('');
                    setNewPassword('');
                    setNewUserRole('usuario');
                    setError(null);
                    showToast("Utilizador adicionado com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao adicionar utilizador:", e);
                    setError(e.message || "Erro ao adicionar utilizador. Tente novamente.");
                    showToast("Erro ao adicionar utilizador.", "error");
                } finally {
                    setIsLoading(false);
                }
            }, [newUsername, newPassword, newUserRole, showToast]); // Dependencies for useCallback

            const confirmDeleteUser = React.useCallback((user) => {
                setUserToDelete(user);
                setShowConfirmModal(true);
            }, []); // No dependencies for useCallback

            const handleDeleteUser = React.useCallback(async () => {
                if (!userToDelete) return;

                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                    // Delete user from 'app_users' table
                    await SupabaseService.deleteDocument('app_users', userToDelete.id);
                    // Optionally, delete from supabase Auth as well if this is the only place managing users
                    // const { error: authDeleteError } = await supabase.auth.admin.deleteUser(userToDelete.id);
                    // if (authDeleteError) console.error("Erro ao eliminar utilizador do supabase Auth:", authDeleteError);

                    showToast("Utilizador eliminado com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao eliminar utilizador:", e);
                    setError("Erro ao eliminar utilizador. Tente novamente.");
                    showToast("Erro ao eliminar utilizador.", "error");
                } finally {
                    setIsLoading(false);
                    setUserToDelete(null);
                }
            }, [userToDelete, showToast]); // Dependencies for useCallback

            return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Utilizadores"),
                    error && (
                        React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                            React.createElement('strong', { className: "font-bold" }, "Erro:"),
                            React.createElement('span', { className: "block sm:inline" }, " ", error)
                        )
                    ),
                    React.createElement('form', { onSubmit: handleAddUser, className: "grid grid-cols-1 md:grid-cols-2 gap-4 mb-6" },
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "newUsername", className: "block text-sm font-medium text-gray-700 mb-1" }, "Nome de Utilizador (E-mail)"),
                            React.createElement('input', {
                                type: "email",
                                id: "newUsername",
                                value: newUsername,
                                onChange: (e) => setNewUsername(e.target.value),
                                className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                placeholder: "Ex: joao.silva@empresa.com",
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "newPassword", className: "block text-sm font-medium text-gray-700 mb-1" }, "Senha"),
                            React.createElement('input', {
                                type: "password",
                                id: "newPassword",
                                value: newPassword,
                                onChange: (e) => setNewPassword(e.target.value),
                                className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                placeholder: "Digite a senha",
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "newUserRole", className: "block text-sm font-medium text-gray-700 mb-1" }, "Função"),
                            React.createElement('select', {
                                id: "newUserRole",
                                value: newUserRole,
                                onChange: (e) => setNewUserRole(e.target.value),
                                className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                required: true,
                                disabled: isLoading
                            },
                                roles.map((role) => (
                                    React.createElement('option', { key: role, value: role }, role.charAt(0).toUpperCase() + role.slice(1))
                                ))
                            )
                        ),
                        React.createElement('div', { className: "md:col-span-2 flex justify-center" },
                            React.createElement('button', {
                                type: "submit",
                                className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                disabled: isLoading
                            },
                                isLoading ? (
                                    React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                        React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                        React.createElement('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                )
                            ) : (
                                React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-2 h-5 w-5" })
                            ),
                            isLoading ? 'A adicionar...' : 'Adicionar Utilizador'
                        )
                    ),
                    React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                        React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                            React.createElement('thead', { className: "bg-gray-100" },
                                React.createElement('tr', null,
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Utilizador (E-mail)"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Função"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Ações")
                                )
                            ),
                            React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                isLoading && usersList.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "A carregar utilizadores...")
                                    )
                                ) : usersList.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhum utilizador registado.")
                                    )
                                ) : (
                                    usersList.map((user) => (
                                        React.createElement('tr', { key: user.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, user.username),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize" }, user.role),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                React.createElement('button', {
                                                    onClick: () => confirmDeleteUser(user),
                                                    className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150",
                                                    title: "Eliminar Utilizador",
                                                    disabled: isLoading
                                                },
                                                    React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                                )
                                            )
                                        )
                                    ))
                                )
                            )
                        )
                    ),
                    showConfirmModal && React.createElement(ConfirmationModal, {
                        message: `Tem a certeza que deseja eliminar o utilizador "${userToDelete?.username}"?`,
                        onConfirm: handleDeleteUser,
                        onCancel: React.useCallback(() => setShowConfirmModal(false), []) // Memoize inline function
                    })
                )
            );
        });

        // Componente para Gerenciamento de Regionais (Novo), memoized
        const RegionalManagement = React.memo(function RegionalManagement({ userId, showToast }) {
            const [newRegionalName, setNewRegionalName] = React.useState('');
            const [availableBranches, setAvailableBranches] = React.useState([]);
            const [selectedBranches, setSelectedBranches] = React.useState([]);
            const [regionalsList, setRegionalsList] = React.useState([]);
            const [error, setError] = React.useState(null);
            const [isLoading, setIsLoading] = React.useState(false);
            const [showConfirmModal, setShowConfirmModal] = React.useState(false);
            const [regionalToDelete, setRegionalToDelete] = React.useState(null);

            // Fetch branches and regionals in real-time
            React.useEffect(() => {
                if (!userId) return;

                setIsLoading(true);

                // Listen to branches
                const unsubscribeBranches = SupabaseService.listenToTable('filiais', (data) => {
                    const sortedData = data.sort((a, b) => a.name.localeCompare(b.name));
                    setAvailableBranches(sortedData.map(b => b.name));
                    setError(null);
                }, [{ field: 'created_by_username', value: userId }]); // Filter by current user's ID

                // Listen to regionals
                const unsubscribeRegionals = SupabaseService.listenToTable('regionais', (data) => {
                    const sortedData = data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    setRegionalsList(sortedData);
                    setError(null);
                    setIsLoading(false);
                }, [{ field: 'created_by_username', value: userId }]); // Filter by current user's ID

                return () => {
                    unsubscribeBranches();
                    unsubscribeRegionals();
                }; // Cleanup listeners
            }, [userId]); // Dependency array includes userId

            const handleAddRegional = React.useCallback(async (e) => {
                e.preventDefault();
                if (!newRegionalName.trim()) {
                    setError("O nome da regional não pode estar vazio.");
                    showToast("O nome da regional não pode estar vazio.", "error");
                    return;
                }
                if (selectedBranches.length === 0) {
                    setError("Selecione pelo menos uma filial para a regional.");
                    showToast("Selecione pelo menos uma filial.", "error");
                    return;
                }

                setIsLoading(true);
                try {
                    await SupabaseService.addDocument('regionais', { name: newRegionalName.trim(), responsible_branches: selectedBranches, created_by_username: userId });
                    setNewRegionalName('');
                    setSelectedBranches([]);
                    setError(null);
                    showToast("Regional adicionada com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao adicionar regional:", e);
                    setError("Erro ao adicionar regional. Tente novamente.");
                    showToast("Erro ao adicionar regional.", "error");
                } finally {
                    setIsLoading(false);
                }
            }, [newRegionalName, selectedBranches, userId, showToast]); // Dependencies for useCallback

            const confirmDeleteRegional = React.useCallback((regional) => {
                setRegionalToDelete(regional);
                setShowConfirmModal(true);
            }, []); // No dependencies for useCallback

            const handleDeleteRegional = React.useCallback(async () => {
                if (!regionalToDelete) return;

                setIsLoading(true);
                setShowConfirmModal(false); // Close modal
                try {
                    await SupabaseService.deleteDocument('regionais', regionalToDelete.id);
                    showToast("Regional eliminada com sucesso!", "success");
                } catch (e) {
                    console.error("Erro ao eliminar regional:", e);
                    setError("Erro ao eliminar regional. Tente novamente.");
                    showToast("Erro ao eliminar regional.", "error");
                } finally {
                    setIsLoading(false);
                    setRegionalToDelete(null);
                }
            }, [regionalToDelete, showToast]); // Dependencies for useCallback

            const handleBranchSelection = React.useCallback((branchName) => {
                setSelectedBranches(prev =>
                    prev.includes(branchName)
                        ? prev.filter(name => name !== branchName)
                        : [...prev, branchName]
                );
            }, []); // No dependencies for useCallback

            return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-4 text-center" }, "Cadastro de Regionais"),
                    error && (
                        React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                            React.createElement('strong', { className: "font-bold" }, "Erro:"),
                            React.createElement('span', { className: "block sm:inline" }, " ", error)
                        )
                    ),
                    React.createElement('form', { onSubmit: handleAddRegional, className: "space-y-6 mb-6" },
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "newRegionalName", className: "block text-sm font-medium text-gray-700 mb-1" }, "Nome da Regional"),
                            React.createElement('input', {
                                type: "text",
                                id: "newRegionalName",
                                value: newRegionalName,
                                onChange: (e) => setNewRegionalName(e.target.value),
                                className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                placeholder: "Ex: Regional Nordeste",
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Filiais Responsáveis:"),
                            React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 max-h-48 overflow-y-auto border border-gray-300 rounded-md p-3" },
                                isLoading && availableBranches.length === 0 ? (
                                    React.createElement('p', { className: "text-sm text-gray-500 col-span-full" }, "A carregar filiais...")
                                ) : availableBranches.length === 0 ? (
                                    React.createElement('p', { className: "text-sm text-gray-500 col-span-full" }, "Nenhuma filial disponível. Registe filiais primeiro.")
                                ) : (
                                    availableBranches.map(branchName => (
                                        React.createElement('div', { key: branchName, className: "flex items-center" },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                id: `branch-${branchName}`,
                                                checked: selectedBranches.includes(branchName),
                                                onChange: () => handleBranchSelection(branchName),
                                                className: "h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 transition duration-150 ease-in-out",
                                                disabled: isLoading
                                            }),
                                            React.createElement('label', { htmlFor: `branch-${branchName}`, className: "ml-2 text-sm text-gray-700" }, branchName)
                                        )
                                    ))
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex justify-center" },
                            React.createElement('button', {
                                type: "submit",
                                className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                                disabled: isLoading
                            },
                                isLoading ? (
                                    React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                        React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                        React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                    )
                                ) : (
                                    React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-2 h-5 w-5" })
                                ),
                                isLoading ? 'A adicionar...' : 'Adicionar Regional'
                            )
                        )
                    ),
                    React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                        React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                            React.createElement('thead', { className: "bg-gray-100" },
                                React.createElement('tr', null,
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Regional"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filiais Responsáveis"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-right text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Ações")
                                )
                            ),
                            React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                isLoading && regionalsList.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "A carregar regionais...")
                                    )
                                ) : regionalsList.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "3", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhuma regional registada.")
                                    )
                                ) : (
                                    regionalsList.map((regional) => (
                                        React.createElement('tr', { key: regional.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, regional.name),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" },
                                                regional.responsible_branches && regional.responsible_branches.length > 0
                                                    ? regional.responsible_branches.join(', ')
                                                    : 'N/A'
                                            ),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-right text-sm font-medium" },
                                                React.createElement('button', {
                                                    onClick: () => confirmDeleteRegional(regional),
                                                    className: "text-red-600 hover:text-red-800 ml-4 transition-colors duration-150",
                                                    title: "Eliminar Regional",
                                                    disabled: isLoading
                                                },
                                                    React.createElement(LucideIcon, { name: "Trash2", className: "h-5 w-5" })
                                                )
                                            )
                                        )
                                    ))
                                )
                            )
                        )
                    ),
                    showConfirmModal && React.createElement(ConfirmationModal, {
                        message: `Tem a certeza que deseja eliminar a regional "${regionalToDelete?.name}"?`,
                        onConfirm: handleDeleteRegional,
                        onCancel: React.useCallback(() => setShowConfirmModal(false), []) // Memoize inline function
                    })
                )
            );
        });

        // Componente para Troca de Filial, memoized
        const BranchTransfer = React.memo(function BranchTransfer({ userId, setCurrentPage, showToast }) {
            const [plate, setNewPlate] = React.useState('');
            const [newBranch, setNewBranch] = React.useState('');
            const [executionDate, setExecutionDate] = React.useState('');
            const [branches, setBranches] = React.useState([]);
            const [error, setError] = React.useState(null);
            const [isLoading, setIsLoading] = React.useState(false);

            // Fetch branches in real-time
            React.useEffect(() => {
                if (!userId) return;
                setIsLoading(true);
                const unsubscribe = SupabaseService.listenToTable('filiais', (data) => {
                    const sortedData = data.sort((a, b) => a.name.localeCompare(b.name));
                    setBranches(sortedData.map(b => b.name));
                    setError(null);
                    setIsLoading(false);
                }, [{ field: 'created_by_username', value: userId }]); // Filter by current user's ID
                return () => unsubscribe(); // Cleanup listener
            }, [userId]); // Dependency array includes userId

            const handleRegisterTransfer = React.useCallback(async (e) => {
                e.preventDefault();
                setError(null);
                if (!plate.trim() || !newBranch || !executionDate) {
                    setError("Por favor, preencha todos os campos.");
                    showToast("Preencha todos os campos.", "error");
                    return;
                }

                setIsLoading(true);
                try {
                    await SupabaseService.addDocument('trocasFilial', { plate: plate.trim(), newBranch: newBranch, executionDate: executionDate, created_by_username: userId });
                    showToast("Troca de filial registada com sucesso!", "success");
                    setNewPlate('');
                    setNewBranch('');
                    setExecutionDate('');
                } catch (e) {
                    console.error("Erro ao registar troca de filial:", e);
                    setError("Erro ao registar troca de filial. Tente novamente.");
                    showToast("Erro ao registar troca de filial.", "error");
                } finally {
                    setIsLoading(false);
                }
            }, [plate, newBranch, executionDate, userId, showToast]); // Dependencies for useCallback

            const handleGoBack = React.useCallback(() => {
                setCurrentPage('dashboard');
            }, [setCurrentPage]); // Dependency for useCallback

            return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg w-full max-w-2xl mx-auto" },
                    React.createElement('div', { className: "flex items-center mb-6" },
                        React.createElement('button', {
                            onClick: handleGoBack,
                            className: "inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out transform hover:scale-105",
                            disabled: isLoading
                        },
                            React.createElement(LucideIcon, { name: "ArrowLeft", className: "mr-2 h-5 w-5" }),
                            "Voltar"
                        ),
                        React.createElement('h2', { className: "text-2xl font-bold text-gray-800 flex-grow text-center" }, "Troca de Filial Fixo de Equipamento")
                    ),
                    error && (
                        React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                            React.createElement('strong', { className: "font-bold" }, "Erro:"),
                            React.createElement('span', { className: "block sm:inline" }, " ", error)
                        )
                    ),
                    React.createElement('form', { onSubmit: handleRegisterTransfer, className: "space-y-6" },
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "plate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Placa do Equipamento:"),
                            React.createElement('input', {
                                type: "text",
                                id: "plate",
                                value: plate,
                                onChange: (e) => setNewPlate(e.target.value),
                                className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                placeholder: "Digite a placa do equipamento",
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "newBranch", className: "block text-sm font-medium text-gray-700 mb-1" }, "Nova Filial:"),
                            React.createElement('div', { className: "relative" },
                                React.createElement('select', {
                                    id: "newBranch",
                                    value: newBranch,
                                    onChange: (e) => setNewBranch(e.target.value),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm appearance-none pr-8 transition duration-150 ease-in-out",
                                    required: true,
                                    disabled: isLoading
                                },
                                    React.createElement('option', { value: "" }, "Selecione..."),
                                    isLoading && branches.length === 0 ? (
                                        React.createElement('option', { disabled: true }, "A carregar filiais...")
                                    ) : (
                                        branches.map((branchName) => (
                                            React.createElement('option', { key: branchName, value: branchName }, branchName)
                                        ))
                                    )
                                ),
                                React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5 text-gray-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none" })
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { htmlFor: "executionDate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Data de Execução:"),
                            React.createElement('div', { className: "relative" },
                                React.createElement('input', {
                                    type: "date",
                                    id: "executionDate",
                                    value: executionDate,
                                    onChange: (e) => setExecutionDate(e.target.value),
                                    className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                    required: true,
                                    disabled: isLoading
                                }),
                                React.createElement(LucideIcon, { name: "CalendarDays", className: "h-5 w-5 text-gray-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none" })
                            )
                        ),
                        React.createElement('button', {
                            type: "submit",
                            className: "w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105",
                            disabled: isLoading
                        },
                            isLoading ? (
                                React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                    React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                    React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                )
                            ) : (
                                "Registar Troca"
                            )
                        )
                    )
                )
            );
        });

        // Novo Componente: Dashboard (agora com funcionalidades de alteração de placas), memoized
        const Dashboard = React.memo(function Dashboard({ userId, showToast }) {
            const [equipmentCounts, setEquipmentCounts] = React.useState({
                'BOMBA LANÇA': 0,
                'BOMBA': 0,
                'BETONEIRA': 0,
            });
            const [animatedCounts, setAnimatedCounts] = React.useState({
                'BOMBA LANÇA': 0,
                'BOMBA': 0,
                'BETONEIRA': 0,
            });
            const [registros, setRegistros] = React.useState([]);
            const [searchTerm, setSearchTerm] = React.useState('');
            const [error, setError] = React.useState(null);
            const [startDate, setStartDate] = React.useState('');
            const [endDate, setEndDate] = React.useState('');
            const [selectedUser, setSelectedUser] = React.useState('Todos os Responsáveis');
            const [availableUsers, setAvailableUsers] = React.useState(['Todos os Responsáveis']);
            const [isLoading, setIsLoading] = React.useState(false);

            // Animated counter effect
            const animateCount = React.useCallback((targetCount, type) => {
                let start = 0;
                const duration = 1000; // 1 second
                const increment = targetCount / (duration / 16); // ~60 frames per second

                const step = () => {
                    start += increment;
                    if (start < targetCount) {
                        setAnimatedCounts(prev => ({ ...prev, [type]: Math.ceil(start) }));
                        requestAnimationFrame(step);
                    } else {
                        setAnimatedCounts(prev => ({ ...prev, [type]: targetCount }));
                    }
                };
                requestAnimationFrame(step);
            }, []); // No dependencies for useCallback as it's a generic animation logic

            // Fetch available users (public table)
            React.useEffect(() => {
                if (!userId) return;
                const fetchAvailableUsers = async () => {
                    try {
                        const users = await SupabaseService.getDocuments('app_users'); // No filter needed for public table
                        setAvailableUsers(['Todos os Responsáveis', ...users.map(u => u.username)]);
                    } catch (e) {
                        console.error("Erro ao buscar utilizadores disponíveis no supabase:", e);
                        setError("Erro ao carregar lista de utilizadores. Por favor, recarregue a página.");
                        showToast("Erro ao carregar utilizadores.", "error");
                    }
                };
                fetchAvailableUsers();
            }, [userId, showToast]); // Dependencies for useEffect

            // Fetch equipment counts
            React.useEffect(() => {
                if (!userId) return;
                setIsLoading(true);
                const unsubscribe = SupabaseService.listenToTable('equipamentos', (data) => {
                    const counts = {
                        'BOMBA LANÇA': 0,
                        'BOMBA': 0,
                        'BETONEIRA': 0,
                    };
                    data.forEach(item => {
                        if (counts.hasOwnProperty(item.type)) {
                            counts[item.type]++;
                        }
                    });
                    setEquipmentCounts(counts);
                    // Animate counts
                    Object.keys(counts).forEach(type => {
                        animateCount(counts[type], type);
                    });
                    setError(null);
                    setIsLoading(false);
                }, [{ field: 'created_by_username', value: userId }]); // Filter by current user's ID
                return () => unsubscribe(); // Cleanup listener
            }, [userId, animateCount]); // Dependencies for useEffect

            // Fetch transfer records
            React.useEffect(() => {
                if (!userId) return;
                setIsLoading(true);

                const filters = [{ field: 'created_by_username', value: userId }]; // Always filter by current user's ID

                const unsubscribe = SupabaseService.listenToTable('trocasFilial', (data) => {
                    // Sort data by created_at in descending order
                    const sortedData = data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                    // Apply in-memory filtering for date range and user if needed, as supabase doesn't support
                    // complex queries like orderBy on different fields with range filters without indexes.
                    // For simplicity and to avoid complex index requirements, we filter after fetching.
                    const filteredData = sortedData.filter(registro => {
                        const matchesDate = (!startDate || registro.executionDate >= startDate) && (!endDate || registro.executionDate <= endDate);
                        const matchesUser = (selectedUser === 'Todos os Responsáveis' || registro.created_by_username === selectedUser);
                        return matchesDate && matchesUser;
                    });
                    setRegistros(filteredData);
                    setError(null);
                    setIsLoading(false);
                }, filters); // Dependencies for supabase listener
                return () => unsubscribe(); // Cleanup listener
            }, [userId, startDate, endDate, selectedUser]); // Dependencies for useEffect

            const handleApplyFilters = React.useCallback(() => {
                // State changes for startDate, endDate, selectedUser will trigger the useEffect for fetching records.
                // No explicit action needed here beyond state updates.
            }, []); // No dependencies for useCallback as it just relies on state changes

            const exportToCSV = React.useCallback(() => {
                const headers = ["Filial", "Placa Antiga", "Placa Nova", "Data da Alteração"];
                const rows = registros.map(registro => [
                    registro.newBranch, // Assuming newBranch is the 'filial' in this context
                    registro.plate, // Assuming plate is the 'placa antiga'
                    registro.plate, // No 'placa nova' in trocasFilial, using plate again for now
                    registro.executionDate
                ]);

                let csvContent = headers.map(header => `"${header}"`).join(";") + "\n";
                rows.forEach(row => {
                    csvContent += row.map(field => `"${field}"`).join(";") + "\n";
                });

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    link.setAttribute("download", "alteracoes_placa.csv");
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }, [registros]); // Dependency for useCallback

            const filteredRegistros = React.useMemo(() => {
                return registros.filter(registro =>
                    registro.newBranch.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    registro.plate.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    registro.executionDate.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }, [registros, searchTerm]); // Dependencies for useMemo

            // Calculate total equipment for chart
            const totalEquipment = React.useMemo(() => {
                return Object.values(equipmentCounts).reduce((sum, count) => sum + count, 0);
            }, [equipmentCounts]); // Dependency for useMemo

            return (
                React.createElement('div', { className: "bg-white p-6 rounded-xl shadow-lg" },
                    React.createElement('h2', { className: "text-2xl font-bold text-gray-800 mb-6 text-center" }, "Dashboard de Equipamentos Ativos"),
                    error && (
                        React.createElement('div', { className: "bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4", role: "alert" },
                            React.createElement('strong', { className: "font-bold" }, "Erro:"),
                            React.createElement('span', { className: "block sm:inline" }, " ", error)
                        )
                    ),

                    React.createElement('div', { className: "mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50" },
                        React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4" }, "Filtrar Registos"),
                        React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end" },
                            React.createElement('div', { className: "relative" },
                                React.createElement('label', { htmlFor: "startDate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Data Início"),
                                React.createElement('div', { className: "flex items-center border border-gray-300 rounded-md shadow-sm" },
                                    React.createElement('input', {
                                        type: "date",
                                        id: "startDate",
                                        value: startDate,
                                        onChange: (e) => setStartDate(e.target.value),
                                        className: "block w-full px-3 py-2 bg-transparent focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                        disabled: isLoading
                                    }),
                                    React.createElement(LucideIcon, { name: "CalendarDays", className: "h-5 w-5 text-gray-400 mr-2" })
                                )
                            ),
                            React.createElement('div', { className: "relative" },
                                React.createElement('label', { htmlFor: "endDate", className: "block text-sm font-medium text-gray-700 mb-1" }, "Data Fim"),
                                React.createElement('div', { className: "flex items-center border border-gray-300 rounded-md shadow-sm" },
                                    React.createElement('input', {
                                        type: "date",
                                        id: "endDate",
                                        value: endDate,
                                        onChange: (e) => setEndDate(e.target.value),
                                        className: "block w-full px-3 py-2 bg-transparent focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                        disabled: isLoading
                                    }),
                                    React.createElement(LucideIcon, { name: "CalendarDays", className: "h-5 w-5 text-gray-400 mr-2" })
                                )
                            ),

                            React.createElement('div', { className: "relative" },
                                React.createElement('label', { htmlFor: "responsibleUser", className: "block text-sm font-medium text-gray-700 mb-1" }, "Responsável"),
                                React.createElement('div', { className: "flex items-center border border-gray-300 rounded-md shadow-sm" },
                                    React.createElement(LucideIcon, { name: "User", className: "h-5 w-5 text-gray-400 ml-3" }),
                                    React.createElement('select', {
                                        id: "responsibleUser",
                                        value: selectedUser,
                                        onChange: (e) => setSelectedUser(e.target.value),
                                        className: "block w-full px-3 py-2 bg-transparent focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm appearance-none pr-8 transition duration-150 ease-in-out",
                                        disabled: isLoading
                                    },
                                        availableUsers.map(user => (
                                            React.createElement('option', { key: user, value: user }, user)
                                        ))
                                    ),
                                    React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5 text-gray-400 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none" })
                                )
                            ),

                            React.createElement('div', { className: "md:col-span-3 lg:col-span-1 flex justify-center md:justify-start" },
                                React.createElement('button', {
                                    onClick: handleApplyFilters,
                                    className: "inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out transform hover:scale-105 w-full md:w-auto",
                                    disabled: isLoading
                                },
                                    isLoading ? (
                                        React.createElement('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                            React.createElement('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                            React.createElement('path', { className: "opacity-75", fill: "currentColor", d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                                        )
                                    ) : (
                                        React.createElement(LucideIcon, { name: "Search", className: "mr-2 h-5 w-5" })
                                    ),
                                    isLoading ? 'A aplicar...' : 'Aplicar Filtros'
                                )
                            )
                        )
                    ),

                    React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4 border-b pb-2" }, "Visão Geral dos Equipamentos"),
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" },
                        React.createElement('div', { className: "bg-blue-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                            React.createElement('div', { className: "flex items-center" },
                                React.createElement(LucideIcon, { name: "Truck", className: "h-8 w-8 text-blue-600 mr-3" }),
                                React.createElement('div', null,
                                    React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "BOMBA LANÇA"),
                                    React.createElement('p', { className: "text-2xl font-bold text-blue-800" }, isLoading ? '...' : animatedCounts['BOMBA LANÇA'])
                                )
                            )
                        ),
                        React.createElement('div', { className: "bg-green-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                            React.createElement('div', { className: "flex items-center" },
                                React.createElement(LucideIcon, { name: "Truck", className: "h-8 w-8 text-green-600 mr-3" }),
                                React.createElement('div', null,
                                    React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "BETONEIRA"),
                                    React.createElement('p', { className: "text-2xl font-bold text-green-800" }, isLoading ? '...' : animatedCounts['BETONEIRA'])
                                )
                            )
                        ),
                        React.createElement('div', { className: "bg-yellow-50 p-4 rounded-lg shadow-sm flex items-center justify-between transform transition-transform duration-200 hover:scale-105 hover:shadow-lg" },
                            React.createElement('div', { className: "flex items-center" },
                                React.createElement(LucideIcon, { name: "Truck", className: "h-8 w-8 text-yellow-600 mr-3" }),
                                React.createElement('div', null,
                                    React.createElement('p', { className: "text-lg font-semibold text-gray-700" }, "BOMBA"),
                                    React.createElement('p', { className: "text-2xl font-bold text-yellow-800" }, isLoading ? '...' : animatedCounts['BOMBA'])
                                )
                            )
                        ),
                    ),

                    React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4 border-b pb-2 mt-8" }, "Distribuição de Equipamentos"),
                    React.createElement('div', { className: "mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50" },
                        totalEquipment === 0 ? (
                            React.createElement('p', { className: "text-center text-gray-500" }, isLoading ? "A carregar distribuição..." : "Nenhum equipamento para exibir a distribuição.")
                        ) : (
                            Object.keys(equipmentCounts).map(type => {
                                const percentage = (equipmentCounts[type] / totalEquipment) * 100;
                                const barColor = type === 'BOMBA LANÇA' ? 'bg-blue-600' : type === 'BETONEIRA' ? 'bg-green-600' : 'bg-yellow-600';
                                return (
                                    React.createElement('div', { key: type, className: "mb-4" },
                                        React.createElement('div', { className: "flex justify-between mb-1 text-sm font-medium text-gray-700" },
                                            React.createElement('span', null, type),
                                            React.createElement('span', null, `${percentage.toFixed(1)}%`)
                                        ),
                                        React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-2.5" },
                                            React.createElement('div', { className: `${barColor} h-2.5 rounded-full transition-all duration-500 ease-out`, style: { width: `${percentage}%` } })
                                        )
                                    )
                                );
                            })
                        )
                    ),


                    React.createElement('h3', { className: "text-xl font-semibold text-gray-700 mb-4 border-b pb-2 mt-8" }, "Registos de Alteração de Placas"),
                    React.createElement('div', { className: "flex justify-between items-center mb-4" },
                        React.createElement('div', { className: "relative flex-grow mr-4" },
                            React.createElement('input', {
                                type: "text",
                                placeholder: "Pesquisar registos...",
                                value: searchTerm,
                                onChange: (e) => setSearchTerm(e.target.value),
                                className: "block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm transition duration-150 ease-in-out",
                                disabled: isLoading
                            }),
                            React.createElement('div', { className: "absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none" },
                                React.createElement(LucideIcon, { name: "Search", className: "h-5 w-5 text-gray-400" })
                            )
                        ),
                        React.createElement('button', {
                            onClick: exportToCSV,
                            className: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out transform hover:scale-105",
                            disabled: isLoading
                        },
                            React.createElement(LucideIcon, { name: "FileText", className: "mr-2 h-5 w-5" }),
                            "Exportar CSV"
                        )
                    ),

                    React.createElement('div', { className: "overflow-x-auto rounded-lg shadow-md border border-gray-200" },
                        React.createElement('table', { className: "min-w-full divide-y divide-gray-200" },
                            React.createElement('thead', { className: "bg-gray-100" },
                                React.createElement('tr', null,
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Filial"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa Antiga"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Placa Nova"),
                                    React.createElement('th', { scope: "col", className: "px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider" }, "Data Alteração")
                                )
                            ),
                            React.createElement('tbody', { className: "bg-white divide-y divide-gray-200" },
                                isLoading && filteredRegistros.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "4", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "A carregar registos...")
                                    )
                                ) : filteredRegistros.length === 0 ? (
                                    React.createElement('tr', null,
                                        React.createElement('td', { colSpan: "4", className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" }, "Nenhum registo encontrado.")
                                    )
                                ) : (
                                    filteredRegistros.map((registro) => (
                                        React.createElement('tr', { key: registro.id, className: "hover:bg-gray-50 transition-colors duration-150" },
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" }, registro.newBranch),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, registro.plate),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, registro.plate),
                                            React.createElement('td', { className: "px-6 py-4 whitespace-nowrap text-sm text-gray-500" }, registro.created_at ? new Date(registro.created_at).toLocaleDateString() : 'N/A')
                                        )
                                    ))
                                )
                            )
                        )
                    )
                )
            );
        });

        // Componente para a tela vazia inicial, memoized
        const EmptyPanel = React.memo(function EmptyPanel() {
            return (
                React.createElement('div', { className: "flex flex-col items-center justify-center min-h-[calc(100vh-16rem)] bg-white p-6 rounded-xl shadow-lg text-center" },
                    React.createElement('h2', { className: "text-4xl font-extrabold text-blue-600 text-center mb-4" }, "SISTEMA DE GERENCIAMENTO"),
                    React.createElement('p', { className: "text-lg text-gray-700 mt-4 max-w-2xl leading-relaxed" }, "O SISTEMA DE GERENCIAMENTO é um aplicativo desenvolvido para controlar de forma prática e eficiente a troca de placas entre usinas. Ele permite registar, rastrear e organizar as movimentações de forma centralizada, garantindo agilidade e segurança nas operações.")
                )
            );
        });

        // Componente principal da Aplicação, memoized
        const App = React.memo(function App() {
            const [userId, setUserId] = React.useState(null); // supabase user ID (UUID)
            const [username, setUsername] = React.useState(null); // Username from app_users table
            const [userRole, setUserRole] = React.useState(null);
            const [isAuthReady, setIsAuthReady] = React.useState(false);
            const [currentPage, setCurrentPage] = React.useState('emptyPanel');
            const [isSidebarOpen, setIsSidebarOpen] = React.useState(false);
            const [isCadastroOpen, setIsCadastroOpen] = React.useState(false);
            const [isOperacionalOpen, setIsOperacionalOpen] = React.useState(false);
            const [error, setError] = React.useState(null);
            const [toastMessage, setToastMessage] = React.useState(null);
            const [toastType, setToastType] = React.useState(null);

            const showToast = React.useCallback((message, type) => {
                setToastMessage(message);
                setToastType(type);
            }, []); // No dependencies for useCallback

            const clearToast = React.useCallback(() => {
                setToastMessage(null);
                setToastType(null);
            }, []); // No dependencies for useCallback

            // Authenticate and set up auth state listener
            React.useEffect(() => {
                const { data: authListener } = supabase.auth.onAuthStateChange(async (event, session) => {
                    if (session) {
                        setUserId(session.user.id);
                        // Fetch user details from 'app_users' table
                        try {
                            const users = await SupabaseService.getDocuments('app_users', [{ field: 'id', operator: '==', value: session.user.id }]);
                            if (users && users.length > 0) {
                                setUsername(users[0].username);
                                setUserRole(users[0].role);
                            } else {
                                // If user exists in supabase Auth but not in app_users, sign out or handle error
                                console.warn("Utilizador autenticado no supabase Auth, mas não encontrado em app_users.");
                                await SupabaseService.signOut();
                                setUserId(null);
                                setUsername(null);
                                setUserRole(null);
                            }
                        } catch (e) {
                            console.error("Erro ao buscar detalhes do utilizador no supabase:", e);
                            setError("Erro ao carregar dados do utilizador.");
                            await SupabaseService.signOut();
                            setUserId(null);
                            setUsername(null);
                            setUserRole(null);
                        }
                    } else {
                        setUserId(null);
                        setUsername(null);
                        setUserRole(null);
                    }
                    setIsAuthReady(true);
                });

                // Check initial session
                SupabaseService.getSession().then(session => {
                    if (session && session.user) {
                        setUserId(session.user.id);
                        // Fetch user details from 'app_users' table
                        SupabaseService.getDocuments('app_users', [{ field: 'id', operator: '==', value: session.user.id }])
                            .then(users => {
                                if (users && users.length > 0) {
                                    setUsername(users[0].username);
                                    setUserRole(users[0].role);
                                } else {
                                    console.warn("Utilizador autenticado no supabase Auth, mas não encontrado em app_users.");
                                    SupabaseService.signOut();
                                    setUserId(null);
                                    setUsername(null);
                                    setUserRole(null);
                                }
                            })
                            .catch(e => {
                                console.error("Erro na sessão inicial do supabase:", e);
                                setError("Erro na sessão inicial. Recarregue a página.");
                                setIsAuthReady(true); // Allow app to render login page even if auth fails
                            });
                    }
                    setIsAuthReady(true);
                }).catch(e => {
                    console.error("Erro na sessão inicial do supabase:", e);
                    setError("Erro na sessão inicial. Recarregue a página.");
                    setIsAuthReady(true); // Allow app to render login page even if auth fails
                });

                return () => {
                    authListener.data.subscription.unsubscribe(); // Cleanup auth listener
                };
            }, []); // Empty dependency array means this runs once on mount

            const handleLogin = React.useCallback(async (role, loggedInUsername) => {
                setUserRole(role);
                setUsername(loggedInUsername); // Set username
                const session = await SupabaseService.getSession();
                if (session && session.user) {
                    setUserId(session.user.id); // Set userId to supabase Auth UID
                }
                setCurrentPage('emptyPanel');
                showToast("Login realizado com sucesso!", "success");
            }, [showToast]); // Dependency for useCallback

            const handleLogout = React.useCallback(async () => {
                try {
                    await SupabaseService.signOut();
                    setUserRole(null);
                    setUserId(null);
                    setUsername(null);
                    setCurrentPage('login');
                    showToast("Sessão terminada.", "success");
                } catch (e) {
                    console.error("Erro ao terminar sessão:", e);
                    showToast("Erro ao terminar sessão.", "error");
                }
            }, [showToast]); // Dependency for useCallback

            const toggleSidebar = React.useCallback(() => {
                setIsSidebarOpen(prev => !prev);
            }, []); // No dependencies for useCallback

            const closeSidebar = React.useCallback(() => {
                setIsSidebarOpen(false);
            }, []); // No dependencies for useCallback

            const toggleCadastro = React.useCallback(() => {
                setIsCadastroOpen(prev => !prev);
            }, []); // No dependencies for useCallback

            const toggleOperacional = React.useCallback(() => {
                setIsOperacionalOpen(prev => !prev);
            }, []); // No dependencies for useCallback

            if (!isAuthReady) {
                return (
                    React.createElement('div', { className: "flex items-center justify-center min-h-screen bg-gray-100" },
                        React.createElement('div', { className: "text-lg font-semibold text-gray-700" }, "A carregar aplicação...")
                    )
                );
            }

            if (!userRole) {
                return React.createElement(LoginPage, { onLogin: handleLogin });
            }

            return (
                React.createElement('div', { className: "min-h-screen bg-gray-100 font-sans flex" },
                    React.createElement('div', {
                        className: `fixed inset-y-0 left-0 bg-gray-800 text-white w-64 p-4 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} transition-transform duration-300 ease-in-out z-50 rounded-r-xl shadow-lg`
                    },
                        React.createElement('div', { className: "flex items-center justify-between mb-8" },
                            React.createElement('h2', { className: "text-2xl font-bold" }, "Menu"),
                            React.createElement('button', { className: "text-white p-1 rounded-full hover:bg-gray-700 transition-colors", onClick: toggleSidebar },
                                React.createElement(LucideIcon, { name: "X", className: "h-6 w-6" })
                            )
                        ),
                        React.createElement('nav', null,
                            React.createElement('ul', null,
                                React.createElement('li', { className: "mb-2" },
                                    React.createElement('button', {
                                        onClick: () => { setCurrentPage('dashboard'); closeSidebar(); },
                                        className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'dashboard' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-200'}`
                                    },
                                        React.createElement(LucideIcon, { name: "LayoutDashboard", className: "mr-3 h-5 w-5" }),
                                        "Dashboard"
                                    )
                                ),
                                React.createElement('li', { className: "mb-2" },
                                    React.createElement('button', {
                                        onClick: toggleOperacional,
                                        className: `flex items-center justify-between w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${isOperacionalOpen ? 'bg-gray-700 text-white shadow-md' : 'hover:bg-gray-700 text-gray-200'}`
                                    },
                                        React.createElement('span', { className: "flex items-center" },
                                            React.createElement(LucideIcon, { name: "Settings", className: "mr-3 h-5 w-5" }),
                                            "Operacional"
                                        ),
                                        isOperacionalOpen ? React.createElement(LucideIcon, { name: "ChevronUp", className: "h-5 w-5" }) : React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5" })
                                    ),
                                    isOperacionalOpen && (
                                        React.createElement('ul', { className: "ml-6 mt-2 space-y-2" },
                                            React.createElement('li', null,
                                                React.createElement('button', {
                                                    onClick: () => { setCurrentPage('branchTransfer'); closeSidebar(); },
                                                    className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'branchTransfer' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                                },
                                                    React.createElement(LucideIcon, { name: "ArrowLeftRight", className: "mr-3 h-5 w-5" }),
                                                    "Troca de Filial"
                                                )
                                            )
                                        )
                                    )
                                ),
                                userRole === 'administrador' && (
                                    React.createElement('li', { className: "mb-2" },
                                        React.createElement('button', {
                                            onClick: toggleCadastro,
                                            className: `flex items-center justify-between w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${isCadastroOpen ? 'bg-gray-700 text-white shadow-md' : 'hover:bg-gray-700 text-gray-200'}`
                                        },
                                            React.createElement('span', { className: "flex items-center" },
                                                React.createElement(LucideIcon, { name: "PlusCircle", className: "mr-3 h-5 w-5" }),
                                                "Cadastro"
                                            ),
                                            isCadastroOpen ? React.createElement(LucideIcon, { name: "ChevronUp", className: "h-5 w-5" }) : React.createElement(LucideIcon, { name: "ChevronDown", className: "h-5 w-5" })
                                        ),
                                        isCadastroOpen && (
                                            React.createElement('ul', { className: "ml-6 mt-2 space-y-2" },
                                                React.createElement('li', null,
                                                    React.createElement('button', {
                                                        onClick: () => { setCurrentPage('branchManagement'); closeSidebar(); },
                                                        className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'branchManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                                    },
                                                        React.createElement(LucideIcon, { name: "Building", className: "mr-3 h-5 w-5" }),
                                                        "Filiais"
                                                    )
                                                ),
                                                React.createElement('li', null,
                                                    React.createElement('button', {
                                                        onClick: () => { setCurrentPage('equipmentManagement'); closeSidebar(); },
                                                        className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'equipmentManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                                    },
                                                        React.createElement(LucideIcon, { name: "Truck", className: "mr-3 h-5 w-5" }),
                                                        "Equipamentos"
                                                    )
                                                ),
                                                React.createElement('li', { className: "mb-2" },
                                                    React.createElement('button', {
                                                        onClick: () => { setCurrentPage('userManagement'); closeSidebar(); },
                                                        className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'userManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                                    },
                                                        React.createElement(LucideIcon, { name: "Users", className: "mr-3 h-5 w-5" }),
                                                        "Utilizadores"
                                                    )
                                                ),
                                                React.createElement('li', { className: "mb-2" },
                                                    React.createElement('button', {
                                                        onClick: () => { setCurrentPage('regionalManagement'); closeSidebar(); }, // New menu item
                                                        className: `flex items-center w-full px-4 py-2 rounded-lg transition duration-150 ease-in-out ${currentPage === 'regionalManagement' ? 'bg-blue-600 text-white shadow-md' : 'hover:bg-gray-700 text-gray-300'}`
                                                    },
                                                        React.createElement(LucideIcon, { name: "MapPin", className: "mr-3 h-5 w-5" }), // New icon
                                                        "Regionais"
                                                    )
                                                )
                                            )
                                        )
                                    )
                                ),
                                React.createElement('li', { className: "mt-8" },
                                    React.createElement('button', {
                                        onClick: handleLogout,
                                        className: "flex items-center w-full px-4 py-2 rounded-lg text-red-400 hover:bg-gray-700 transition duration-150 ease-in-out"
                                    },
                                        React.createElement(LucideIcon, { name: "LogOut", className: "mr-3 h-5 w-5" }),
                                        "Sair"
                                    )
                                )
                            )
                        )
                    ),

                    isSidebarOpen && (
                        React.createElement('div', {
                            className: "fixed inset-0 bg-black opacity-50 z-40",
                            onClick: closeSidebar
                        })
                    ),

                    React.createElement('div', { className: "flex-1 p-4 flex flex-col items-center" },
                        React.createElement('header', { className: "w-full max-w-full bg-white p-4 rounded-xl shadow-lg mb-8 flex justify-between items-center" },
                            React.createElement('button', { className: "text-gray-700 p-2 rounded-full hover:bg-gray-100 transition-colors", onClick: toggleSidebar },
                                React.createElement(LucideIcon, { name: "Menu", className: "h-6 w-6" })
                            ),
                            React.createElement('h1', { className: "text-4xl font-extrabold text-blue-600 text-center flex-grow" }, "TERC SISTEMAS")
                        ),

                        error && (
                            React.createElement('div', { className: "max-w-full w-full bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 shadow-md", role: "alert" },
                                React.createElement('strong', { className: "font-bold" }, "Erro:"),
                                React.createElement('span', { className: "block sm:inline" }, " ", error)
                            )
                        ),

                        React.createElement('div', { className: "max-w-full w-full" },
                            currentPage === 'emptyPanel' && React.createElement(EmptyPanel, null),
                            currentPage === 'dashboard' && React.createElement(Dashboard, { userId: userId, showToast: showToast }),
                            currentPage === 'branchManagement' && userRole === 'administrador' && React.createElement(BranchManagement, { userId: userId, showToast: showToast }),
                            currentPage === 'equipmentManagement' && userRole === 'administrador' && React.createElement(EquipmentManagement, { userId: userId, showToast: showToast }),
                            currentPage === 'userManagement' && userRole === 'administrador' && React.createElement(UserManagement, { userId: userId, showToast: showToast }),
                            currentPage === 'regionalManagement' && userRole === 'administrador' && React.createElement(RegionalManagement, { userId: userId, showToast: showToast }),
                            currentPage === 'branchTransfer' && React.createElement(BranchTransfer, { userId: userId, setCurrentPage: setCurrentPage, showToast: showToast })
                        ),
                        toastMessage && React.createElement(Toast, { message: toastMessage, type: toastType, onClose: clearToast })
                    )
                )
            );
        });

        // Render the App component
        ReactDOM.render(React.createElement(App, null), document.getElementById('root'));
    </script>
</body>
</html>
